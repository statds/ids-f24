<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>6&nbsp; Data Manipulation – Introduction to Data Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./visualization.html" rel="next">
<link href="./communication.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-626149efe8f5d16e1d391ba177679bf0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./manipulation.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Data Manipulation</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./images/ids-f24.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to Data Science</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preliminaries</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./git.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Project Management</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Reproducible Data Science</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Python Refreshment</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./communication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Communication in Data Science</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./manipulation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Data Manipulation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Visualization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./stats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Statistical Tests and Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Machine Learning: Overview</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./supervised.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Supervised Learning</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./unsupervised.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Unsupervised Learning</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./advanced.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Advanced Topics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Exercises</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">6.1</span> Introduction</a></li>
  <li><a href="#importexport-data" id="toc-importexport-data" class="nav-link" data-scroll-target="#importexport-data"><span class="header-section-number">6.2</span> Import/Export Data</a>
  <ul class="collapse">
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">6.2.1</span> Summary</a></li>
  <li><a href="#package-pandas" id="toc-package-pandas" class="nav-link" data-scroll-target="#package-pandas"><span class="header-section-number">6.2.2</span> Package <code>Pandas</code></a></li>
  <li><a href="#export-the-data-to-a-.csv-file" id="toc-export-the-data-to-a-.csv-file" class="nav-link" data-scroll-target="#export-the-data-to-a-.csv-file"><span class="header-section-number">6.2.3</span> Export the data to a <code>.csv</code> file:</a></li>
  <li><a href="#import-files-in-common-formats-.csv.xlsx.txt" id="toc-import-files-in-common-formats-.csv.xlsx.txt" class="nav-link" data-scroll-target="#import-files-in-common-formats-.csv.xlsx.txt"><span class="header-section-number">6.2.4</span> Import files in common formats: <code>.csv</code>/<code>.xlsx</code>/<code>.txt</code></a></li>
  <li><a href="#import-the-data-from-other-software" id="toc-import-the-data-from-other-software" class="nav-link" data-scroll-target="#import-the-data-from-other-software"><span class="header-section-number">6.2.5</span> Import the data from other software</a></li>
  <li><a href="#view-data-information" id="toc-view-data-information" class="nav-link" data-scroll-target="#view-data-information"><span class="header-section-number">6.2.6</span> View data information</a></li>
  <li><a href="#find-null-values" id="toc-find-null-values" class="nav-link" data-scroll-target="#find-null-values"><span class="header-section-number">6.2.7</span> Find Null Values</a></li>
  </ul></li>
  <li><a href="#sql" id="toc-sql" class="nav-link" data-scroll-target="#sql"><span class="header-section-number">6.3</span> SQL</a>
  <ul class="collapse">
  <li><a href="#table-of-contents" id="toc-table-of-contents" class="nav-link" data-scroll-target="#table-of-contents"><span class="header-section-number">6.3.1</span> Table of Contents</a></li>
  <li><a href="#what-is-a-database" id="toc-what-is-a-database" class="nav-link" data-scroll-target="#what-is-a-database"><span class="header-section-number">6.3.2</span> What is a Database?</a></li>
  <li><a href="#example-relational-database" id="toc-example-relational-database" class="nav-link" data-scroll-target="#example-relational-database"><span class="header-section-number">6.3.3</span> Example Relational Database</a></li>
  <li><a href="#what-is-sql" id="toc-what-is-sql" class="nav-link" data-scroll-target="#what-is-sql"><span class="header-section-number">6.3.4</span> What is SQL?</a></li>
  <li><a href="#crud" id="toc-crud" class="nav-link" data-scroll-target="#crud"><span class="header-section-number">6.3.5</span> CRUD</a></li>
  <li><a href="#implementing-sql-through-python-to-create-a-table" id="toc-implementing-sql-through-python-to-create-a-table" class="nav-link" data-scroll-target="#implementing-sql-through-python-to-create-a-table"><span class="header-section-number">6.3.6</span> Implementing SQL Through Python to Create a Table</a></li>
  <li><a href="#how-to-insert-into-the-sql-table" id="toc-how-to-insert-into-the-sql-table" class="nav-link" data-scroll-target="#how-to-insert-into-the-sql-table"><span class="header-section-number">6.3.7</span> How to Insert into the SQL table?</a></li>
  <li><a href="#how-to-updatedelete-using-sql" id="toc-how-to-updatedelete-using-sql" class="nav-link" data-scroll-target="#how-to-updatedelete-using-sql"><span class="header-section-number">6.3.8</span> How to Update/Delete Using SQL?</a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"><span class="header-section-number">6.3.9</span> </a></li>
  <li><a href="#using-sql-to-work-on-a-csv-file" id="toc-using-sql-to-work-on-a-csv-file" class="nav-link" data-scroll-target="#using-sql-to-work-on-a-csv-file"><span class="header-section-number">6.3.10</span> Using SQL to Work on a CSV file</a></li>
  <li><a href="#queries" id="toc-queries" class="nav-link" data-scroll-target="#queries"><span class="header-section-number">6.3.11</span> Queries</a></li>
  <li><a href="#queries-output" id="toc-queries-output" class="nav-link" data-scroll-target="#queries-output"><span class="header-section-number">6.3.12</span> Queries Output</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">6.3.13</span> Conclusion</a></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading"><span class="header-section-number">6.3.14</span> Further reading</a></li>
  </ul></li>
  <li><a href="#nyc-crash-data" id="toc-nyc-crash-data" class="nav-link" data-scroll-target="#nyc-crash-data"><span class="header-section-number">6.4</span> NYC Crash Data</a></li>
  <li><a href="#cross-platform-data-format-arrow" id="toc-cross-platform-data-format-arrow" class="nav-link" data-scroll-target="#cross-platform-data-format-arrow"><span class="header-section-number">6.5</span> Cross-platform Data Format <code>Arrow</code></a></li>
  <li><a href="#using-the-census-data" id="toc-using-the-census-data" class="nav-link" data-scroll-target="#using-the-census-data"><span class="header-section-number">6.6</span> Using the Census Data</a></li>
  <li><a href="#extracting-and-analyzing-census-tract-data" id="toc-extracting-and-analyzing-census-tract-data" class="nav-link" data-scroll-target="#extracting-and-analyzing-census-tract-data"><span class="header-section-number">6.7</span> Extracting and Analyzing Census Tract Data</a>
  <ul class="collapse">
  <li><a href="#accessing-the-cencus-data" id="toc-accessing-the-cencus-data" class="nav-link" data-scroll-target="#accessing-the-cencus-data"><span class="header-section-number">6.7.1</span> Accessing the cencus Data</a></li>
  <li><a href="#performing-dataframe-operations" id="toc-performing-dataframe-operations" class="nav-link" data-scroll-target="#performing-dataframe-operations"><span class="header-section-number">6.7.2</span> Performing Dataframe Operations</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Data Manipulation</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">6.1</span> Introduction</h2>
<p>Data manipulation is crucial for transforming raw data into a more analyzable format, essential for uncovering patterns and ensuring accurate analysis. This chapter introduces the core techniques for data manipulation in Python, utilizing the Pandas library, a cornerstone for data handling within Python’s data science toolkit.</p>
<p>Python’s ecosystem is rich with libraries that facilitate not just data manipulation but comprehensive data analysis. Pandas, in particular, provides extensive functionality for data manipulation tasks including reading, cleaning, transforming, and summarizing data. Using real-world datasets, we will explore how to leverage Python for practical data manipulation tasks.</p>
<p>By the end of this chapter, you will learn to:</p>
<ul>
<li>Import/export data from/to diverse sources.</li>
<li>Clean and preprocess data efficiently.</li>
<li>Transform and aggregate data to derive insights.</li>
<li>Merge and concatenate datasets from various origins.</li>
<li>Analyze real-world datasets using these techniques.</li>
</ul>
</section>
<section id="importexport-data" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="importexport-data"><span class="header-section-number">6.2</span> Import/Export Data</h2>
<p>This section was written by Deyu Xu, a MS student in Statistics at the time.</p>
<section id="summary" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="summary"><span class="header-section-number">6.2.1</span> Summary</h3>
<p>I would like to divide all of the content into five sections. The fisrt one is exporting data to a <code>.csv</code> file. The second one is importing common formats of data. The third one is importing data from other softwares. The forth one is viewing basic information of the data we have imported. The last one is finding null values.</p>
</section>
<section id="package-pandas" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2" class="anchored" data-anchor-id="package-pandas"><span class="header-section-number">6.2.2</span> Package <code>Pandas</code></h3>
<section id="import-data-based-on-package-pandas" class="level4" data-number="6.2.2.1">
<h4 data-number="6.2.2.1" class="anchored" data-anchor-id="import-data-based-on-package-pandas"><span class="header-section-number">6.2.2.1</span> Import data based on Package <code>Pandas</code></h4>
<p>We need to use the Package, <code>Pandas</code> provided by Python to import data. The first step is to install the Package, <code>Pandas</code>. Python allows us to install different versions of <code>Pandas</code>. We are able to use the following code to install the common cersion.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">## install the common version of Pandas</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>pip install pandas</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The code for installing the latest version is listed.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">## install the latest version of Pandas</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>pip install <span class="op">--</span>upgrade pandas</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Different versions mean there are differnces in the code to achieve the same goal. We will see the specific example in the part of importing <code>.xlsx</code> files.</p>
</section>
</section>
<section id="export-the-data-to-a-.csv-file" class="level3" data-number="6.2.3">
<h3 data-number="6.2.3" class="anchored" data-anchor-id="export-the-data-to-a-.csv-file"><span class="header-section-number">6.2.3</span> Export the data to a <code>.csv</code> file:</h3>
<section id="import-the-cleaned-crashes-data-at-first" class="level4" data-number="6.2.3.1">
<h4 data-number="6.2.3.1" class="anchored" data-anchor-id="import-the-cleaned-crashes-data-at-first"><span class="header-section-number">6.2.3.1</span> Import the cleaned crashes data at first</h4>
<p>Fisrtly, we need to import the file named “nyccrashes_cleaned.feather” <a href="https://github.com/statds/ids-f24/tree/main/data">data source</a>. ‌<code>.feather</code> file is a binary file format for storing and sharing data. It is especially suitable for large-scale data analysis and data science workflows. ‌ It uses Apache Arrow’s columnar storage format, which can store data in binary form. The advantage of using this format of file is elvaluating the standard of reading and writing. We need to choose the function <code>read_feather</code> from <code>Pandas</code> to import the crashes data.</p>
<div id="ac2f6abb" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Choose the Package Pandas</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">## Import the cleaned crashes data</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">## Choose the fcuntion, read_feather from Pandas</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">## Add the relative address of the data file to let your cooperator deal with the code smoothly</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>df_feather <span class="op">=</span> pd.read_feather(<span class="st">"data/nyccrashes_cleaned.feather"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">## Show the top 5 rows of data</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">## Determine whether we import the data successfully</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_feather.head(<span class="dv">5</span>)) <span class="co"># Use the fucntion "head()"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        crash_datetime    borough  zip_code  latitude  longitude  \
0  2024-06-30 17:30:00       None       NaN       NaN        NaN   
1  2024-06-30 00:32:00       None       NaN       NaN        NaN   
2  2024-06-30 07:05:00   BROOKLYN   11235.0  40.58106  -73.96744   
3  2024-06-30 20:47:00  MANHATTAN   10021.0  40.76363  -73.95330   
4  2024-06-30 10:14:00   BROOKLYN   11222.0  40.73046  -73.95149   

                location     on_street_name      cross_street_name  \
0             (0.0, 0.0)               None                   None   
1                   None  BELT PARKWAY RAMP                   None   
2  (40.58106, -73.96744)               None                   None   
3   (40.76363, -73.9533)          FDR DRIVE                   None   
4  (40.73046, -73.95149)  GREENPOINT AVENUE  MC GUINNESS BOULEVARD   

           off_street_name  number_of_persons_injured  ...  \
0              GOLD STREET                          0  ...   
1                     None                          0  ...   
2  2797      OCEAN PARKWAY                          0  ...   
3                     None                          0  ...   
4                     None                          0  ...   

   contributing_factor_vehicle_2  contributing_factor_vehicle_3  \
0                    Unspecified                           None   
1                    Unspecified                           None   
2                           None                           None   
3                           None                           None   
4                    Unspecified                           None   

   contributing_factor_vehicle_4  contributing_factor_vehicle_5  collision_id  \
0                           None                           None       4736746   
1                           None                           None       4736768   
2                           None                           None       4737060   
3                           None                           None       4737510   
4                           None                           None       4736759   

                   vehicle_type_code_1                  vehicle_type_code_2  \
0                                Sedan                                Sedan   
1  Station Wagon/Sport Utility Vehicle  Station Wagon/Sport Utility Vehicle   
2  Station Wagon/Sport Utility Vehicle                                 None   
3                                Sedan                                 None   
4                                  Bus                            Box Truck   

  vehicle_type_code_3 vehicle_type_code_4 vehicle_type_code_5  
0                None                None                None  
1                None                None                None  
2                None                None                None  
3                None                None                None  
4                None                None                None  

[5 rows x 28 columns]</code></pre>
</div>
</div>
<ul>
<li>We have imported the cleaned crashes data successfully.</li>
<li>We utilize the fucntion <code>head(5)</code> to show the top 5 rows of the data.</li>
</ul>
</section>
<section id="export-the-crashes-data-to-a-.csv-file" class="level4" data-number="6.2.3.2">
<h4 data-number="6.2.3.2" class="anchored" data-anchor-id="export-the-crashes-data-to-a-.csv-file"><span class="header-section-number">6.2.3.2</span> Export the crashes data to a <code>.csv</code> file</h4>
<p>It is easy to export the data. The fucntion that helps us to complete this goal is <code>to_csv</code> from <code>Pandas</code>.</p>
<div id="b0eeddc8" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Choose the Package Pandas</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Choose the function "to_csv" from Pandas</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">## Use the argument, "df_feather" storing the data</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">## Export the data to the default working directory</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>df_feather.to_csv(<span class="st">"foreign/nyccrashes_cleaned.csv"</span>) <span class="co"># Add the name of the CSV file</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>We can check whether the corresponding <code>.csv</code> file is generated in the default working directory.</li>
</ul>
<p>We have exported the data to a <code>.csv</code> file in the default working directory.</p>
<p>We will use this <code>.csv</code> file later.</p>
</section>
</section>
<section id="import-files-in-common-formats-.csv.xlsx.txt" class="level3" data-number="6.2.4">
<h3 data-number="6.2.4" class="anchored" data-anchor-id="import-files-in-common-formats-.csv.xlsx.txt"><span class="header-section-number">6.2.4</span> Import files in common formats: <code>.csv</code>/<code>.xlsx</code>/<code>.txt</code></h3>
<section id="csv-files" class="level4" data-number="6.2.4.1">
<h4 data-number="6.2.4.1" class="anchored" data-anchor-id="csv-files"><span class="header-section-number">6.2.4.1</span> <code>.csv</code> files</h4>
<p>We are familiar with <code>.csv</code> files as utilizing them to print some charts by R in the past courses. Now let us import this generated <code>.csv</code> file. We are supposed to choose the function <code>read_csv</code> from <code>Pandas</code>. The following code shows how to import it.</p>
<div id="fb86c6a7" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Choose the Package Pandas</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">## Choose the function "read_csv"</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">## Add the relative address of the generated CSV file</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>df_csv <span class="op">=</span> pd.read_csv(<span class="st">"foreign/nyccrashes_cleaned.csv"</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">## Check the data we have imported</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">## Use the above function "head()" I have introduced</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_csv.head(<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Unnamed: 0       crash_datetime borough  zip_code  latitude  longitude  \
0           0  2024-06-30 17:30:00     NaN       NaN       NaN        NaN   
1           1  2024-06-30 00:32:00     NaN       NaN       NaN        NaN   

     location     on_street_name cross_street_name off_street_name  ...  \
0  (0.0, 0.0)                NaN               NaN     GOLD STREET  ...   
1         NaN  BELT PARKWAY RAMP               NaN             NaN  ...   

   contributing_factor_vehicle_2  contributing_factor_vehicle_3  \
0                    Unspecified                            NaN   
1                    Unspecified                            NaN   

   contributing_factor_vehicle_4  contributing_factor_vehicle_5  collision_id  \
0                            NaN                            NaN       4736746   
1                            NaN                            NaN       4736768   

                   vehicle_type_code_1                  vehicle_type_code_2  \
0                                Sedan                                Sedan   
1  Station Wagon/Sport Utility Vehicle  Station Wagon/Sport Utility Vehicle   

   vehicle_type_code_3 vehicle_type_code_4 vehicle_type_code_5  
0                  NaN                 NaN                 NaN  
1                  NaN                 NaN                 NaN  

[2 rows x 29 columns]</code></pre>
</div>
</div>
</section>
<section id="xlsx-files" class="level4" data-number="6.2.4.2">
<h4 data-number="6.2.4.2" class="anchored" data-anchor-id="xlsx-files"><span class="header-section-number">6.2.4.2</span> <code>.xlsx</code> files</h4>
<p>We want to import <code>.xlsx</code> files but there are not suitable <code>.xlsx</code> files. We can transfer the CSV file to a <code>.xlsx</code> file by the fucntion <code>to_excel</code> from <code>Pandas</code>. Let’s see how to achieve this goal according to the following code.</p>
<div id="87187dc9" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Choose the Package Pandas</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">## Use the function "to_excel"</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">## Export the data to the default working directory</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>df_csv.to_excel(<span class="st">"foreign/nyccrashes_cleaned.xlsx"</span>) <span class="co"># Add the name of the Excel file</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Check whether the corresponding <code>.xlsx</code> file is generated in the working directory</li>
</ul>
<p>Now we have generated the <code>.xlsx</code> file covering the same data. And then we can learn how to import <code>.xlsx</code> files. The function wen use is <code>read_excel</code> no matter what <code>Pandas</code> version is.</p>
<ul>
<li>The latest version of <code>Pandas</code> corresponds to the following code.</li>
</ul>
<div id="a0a905d7" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Choose the function "read_excel"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">## Add the command "engine" to read the file smoothly</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>df_excel <span class="op">=</span> pd.read_excel(<span class="st">"foreign/nyccrashes_cleaned.xlsx"</span>, engine <span class="op">=</span> <span class="st">"openpyxl"</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">## Print top 2 rows of the data</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_excel.head(<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Unnamed: 0.1  Unnamed: 0       crash_datetime borough  zip_code  latitude  \
0             0           0  2024-06-30 17:30:00     NaN       NaN       NaN   
1             1           1  2024-06-30 00:32:00     NaN       NaN       NaN   

   longitude    location     on_street_name cross_street_name  ...  \
0        NaN  (0.0, 0.0)                NaN               NaN  ...   
1        NaN         NaN  BELT PARKWAY RAMP               NaN  ...   

  contributing_factor_vehicle_2  contributing_factor_vehicle_3  \
0                   Unspecified                            NaN   
1                   Unspecified                            NaN   

   contributing_factor_vehicle_4  contributing_factor_vehicle_5  collision_id  \
0                            NaN                            NaN       4736746   
1                            NaN                            NaN       4736768   

                   vehicle_type_code_1                  vehicle_type_code_2  \
0                                Sedan                                Sedan   
1  Station Wagon/Sport Utility Vehicle  Station Wagon/Sport Utility Vehicle   

   vehicle_type_code_3  vehicle_type_code_4 vehicle_type_code_5  
0                  NaN                  NaN                 NaN  
1                  NaN                  NaN                 NaN  

[2 rows x 30 columns]</code></pre>
</div>
</div>
<p>The code of the common <code>Pandas</code> version is below. What we need to adjust is to add correct <code>encoding</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df_excel <span class="op">=</span> pd.read_excel(<span class="st">"foreign/nyccrashes_cleaned.xlsx"</span>, engine <span class="op">=</span> <span class="st">"openpyxl"</span>, </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>encoding <span class="op">=</span> <span class="st">"utf-8"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="txt-files" class="level4" data-number="6.2.4.3">
<h4 data-number="6.2.4.3" class="anchored" data-anchor-id="txt-files"><span class="header-section-number">6.2.4.3</span> <code>.txt</code> files</h4>
<p>The last common kind of file is <code>.txt</code> files. We are able to generate the <code>.txt</code> file in the similar way as generatng the <code>.xlsx</code> file. We choose the function <code>to_csv</code> from <code>Pandas</code>. It is necessary to add the command <code>sep="\t"</code>. At the same time, we are supposed to add <code>index=False</code> to avoid the index of Dataframe. The specific code is following.</p>
<div id="da572905" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>df_csv <span class="op">=</span> pd.read_csv(<span class="st">"foreign/nyccrashes_cleaned.csv"</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">## Choose the function "to_csv"</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">## Add the command "sep='\t'"</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">## Add the command "index=False"</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">## Export the data to the default working directory</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>df_csv.to_csv(<span class="st">"foreign/nyccrashes_cleaned.txt"</span>, sep <span class="op">=</span> <span class="st">"</span><span class="ch">\t</span><span class="st">"</span>, index <span class="op">=</span> <span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we get the corresponding <code>.txt</code> file successfully. The next step is to determine the correct encoding of this <code>.txt</code> file. This is because the computer will not read the file successfully without correct encoding. I have listed the code helping us to obtain the correct encoding. We use <code>with</code> statement to deal with data. And then we use the function <code>detect</code> from Package <code>Chardet</code>. The intention of <code>detect</code> is to detect character encoding of text files.</p>
<div id="14c04289" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> chardet</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Use "with" statement </span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"foreign/nyccrashes_cleaned.txt"</span>, <span class="st">"rb"</span>) <span class="im">as</span> f:</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Execute the command "open"</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># And then assign the result to variable "f"</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    raw_data <span class="op">=</span> f.read() <span class="co"># Read the content from "f"</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> chardet.detect(raw_data) </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    encoding <span class="op">=</span> result[<span class="st">"encoding"</span>]</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="bu">str</span>(encoding))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ascii</code></pre>
</div>
</div>
<ul>
<li>Warning: It is possible to generate the encoding which is not “utf-8”.</li>
</ul>
<p>Now we own the <code>.txt</code> file and its correct encoding. The last step is to use the function <code>read_table</code> to import the <code>.txt</code> file. We need to insert the correct encoding too. The corresponding code is following.</p>
<div id="34e6df0a" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Choose the function "read_table"</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">## Add the encoding behind the relative address</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>df_txt <span class="op">=</span> pd.read_table(<span class="st">"foreign/nyccrashes_cleaned.txt"</span>, encoding <span class="op">=</span> <span class="st">"utf-8"</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">## The defualt of function "head()" is top five rows </span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_txt.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Unnamed: 0       crash_datetime    borough  zip_code  latitude  longitude  \
0           0  2024-06-30 17:30:00        NaN       NaN       NaN        NaN   
1           1  2024-06-30 00:32:00        NaN       NaN       NaN        NaN   
2           2  2024-06-30 07:05:00   BROOKLYN   11235.0  40.58106  -73.96744   
3           3  2024-06-30 20:47:00  MANHATTAN   10021.0  40.76363  -73.95330   
4           4  2024-06-30 10:14:00   BROOKLYN   11222.0  40.73046  -73.95149   

                location     on_street_name      cross_street_name  \
0             (0.0, 0.0)                NaN                    NaN   
1                    NaN  BELT PARKWAY RAMP                    NaN   
2  (40.58106, -73.96744)                NaN                    NaN   
3   (40.76363, -73.9533)          FDR DRIVE                    NaN   
4  (40.73046, -73.95149)  GREENPOINT AVENUE  MC GUINNESS BOULEVARD   

           off_street_name  ...  contributing_factor_vehicle_2  \
0              GOLD STREET  ...                    Unspecified   
1                      NaN  ...                    Unspecified   
2  2797      OCEAN PARKWAY  ...                            NaN   
3                      NaN  ...                            NaN   
4                      NaN  ...                    Unspecified   

   contributing_factor_vehicle_3  contributing_factor_vehicle_4  \
0                            NaN                            NaN   
1                            NaN                            NaN   
2                            NaN                            NaN   
3                            NaN                            NaN   
4                            NaN                            NaN   

   contributing_factor_vehicle_5  collision_id  \
0                            NaN       4736746   
1                            NaN       4736768   
2                            NaN       4737060   
3                            NaN       4737510   
4                            NaN       4736759   

                   vehicle_type_code_1                  vehicle_type_code_2  \
0                                Sedan                                Sedan   
1  Station Wagon/Sport Utility Vehicle  Station Wagon/Sport Utility Vehicle   
2  Station Wagon/Sport Utility Vehicle                                  NaN   
3                                Sedan                                  NaN   
4                                  Bus                            Box Truck   

   vehicle_type_code_3 vehicle_type_code_4 vehicle_type_code_5  
0                  NaN                 NaN                 NaN  
1                  NaN                 NaN                 NaN  
2                  NaN                 NaN                 NaN  
3                  NaN                 NaN                 NaN  
4                  NaN                 NaN                 NaN  

[5 rows x 29 columns]</code></pre>
</div>
</div>
</section>
</section>
<section id="import-the-data-from-other-software" class="level3" data-number="6.2.5">
<h3 data-number="6.2.5" class="anchored" data-anchor-id="import-the-data-from-other-software"><span class="header-section-number">6.2.5</span> Import the data from other software</h3>
<p>In this section, all of the specific files generated by the code I provided are stored in the folder which name is “foreign” and can be accessed according to the relative path.</p>
<section id="sas-files" class="level4" data-number="6.2.5.1">
<h4 data-number="6.2.5.1" class="anchored" data-anchor-id="sas-files"><span class="header-section-number">6.2.5.1</span> SAS files</h4>
<section id="transfer-the-.csv-file-to-a-.xpt-file" class="level5" data-number="6.2.5.1.1">
<h5 data-number="6.2.5.1.1" class="anchored" data-anchor-id="transfer-the-.csv-file-to-a-.xpt-file"><span class="header-section-number">6.2.5.1.1</span> Transfer the <code>.csv</code> file to a <code>.xpt</code> file</h5>
<p>The reason why we choose <code>.xpt</code> file is to ensure data types remain consistent during conversion. Firstly, we need to process the data to ensure there is no space in the name of columns. If we don’t do that, we will not achieve the goal. The code of dealing with data is following.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"foreign/nyccrashes_cleaned.csv"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>df_csv_without_unnamed <span class="op">=</span> df.loc[:, <span class="op">~</span>df.columns.<span class="bu">str</span>.contains(<span class="st">"^Unnamed"</span>)]</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>df_csv_without_unnamed.columns<span class="op">=</span>df_csv_without_unnamed.columns.<span class="bu">str</span>.replace(<span class="st">" "</span>, <span class="st">"_"</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>df_csv_without_unnamed.to_csv(<span class="st">"foreign/Without_Unamed.csv"</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We use the Package <code>pyreadstat</code> and the function <code>write_xport</code> from <code>pyreadstat</code> to transfer the <code>.csv</code> file. The corresponding code is following.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyreadstat</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>df_without_unnamed <span class="op">=</span> pd.read_csv(<span class="st">"foreign/Without_Unamed.csv"</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>sas_file <span class="op">=</span> <span class="st">"foreign/SAS.xpt"</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">## Export the data to the default working directory</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>pyreadstat.write_xport(df_without_unnamed, <span class="st">"SAS.xpt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="import-the-generated-.xpt-file" class="level5" data-number="6.2.5.1.2">
<h5 data-number="6.2.5.1.2" class="anchored" data-anchor-id="import-the-generated-.xpt-file"><span class="header-section-number">6.2.5.1.2</span> Import the generated <code>.xpt</code> file</h5>
<p>We use the package <code>pyreadstat</code> too. We choose the function <code>read_xport</code> to import the data. Here is the code.</p>
<div id="32beb1a6" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyreadstat</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Define the Dataframe and metadata</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>df_1, meta <span class="op">=</span> pyreadstat.read_xport(<span class="st">"foreign/SAS.xpt"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co">## Show the Dataframe</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_1.head(<span class="dv">2</span>))</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">## Show the metadata</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(meta)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        crash_datetime borough  zip_code  latitude  longitude    location  \
0  2024-06-30 17:30:00               NaN       NaN        NaN  (0.0, 0.0)   
1  2024-06-30 00:32:00               NaN       NaN        NaN               

      on_street_name cross_street_name off_street_name  \
0                                          GOLD STREET   
1  BELT PARKWAY RAMP                                     

   number_of_persons_injured  ...  contributing_factor_vehicle_2  \
0                        0.0  ...                    Unspecified   
1                        0.0  ...                    Unspecified   

   contributing_factor_vehicle_3  contributing_factor_vehicle_4  \
0                                                                 
1                                                                 

   contributing_factor_vehicle_5  collision_id  \
0                                    4736746.0   
1                                    4736768.0   

                   vehicle_type_code_1                  vehicle_type_code_2  \
0                                Sedan                                Sedan   
1  Station Wagon/Sport Utility Vehicle  Station Wagon/Sport Utility Vehicle   

  vehicle_type_code_3 vehicle_type_code_4 vehicle_type_code_5  
0                                                              
1                                                              

[2 rows x 28 columns]
&lt;pyreadstat._readstat_parser.metadata_container object at 0x115625400&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="rdata-filesthe-suffix-of-this-file-is-.rdata" class="level4" data-number="6.2.5.2">
<h4 data-number="6.2.5.2" class="anchored" data-anchor-id="rdata-filesthe-suffix-of-this-file-is-.rdata"><span class="header-section-number">6.2.5.2</span> rdata files(the suffix of this file is <code>.RData</code>)</h4>
<section id="transfer-the-.csv-file-to-a-.rdata-file" class="level5" data-number="6.2.5.2.1">
<h5 data-number="6.2.5.2.1" class="anchored" data-anchor-id="transfer-the-.csv-file-to-a-.rdata-file"><span class="header-section-number">6.2.5.2.1</span> Transfer the <code>.csv</code> file to a <code>.Rdata</code> file</h5>
<p>We need to install the package <code>rpy2</code></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>pip install rpy2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And then we choose the function <code>pandas2ri</code> The following code helps us achieve the goal.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co">## Use the Package rpy2</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rpy2.robjects <span class="im">as</span> ro</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rpy2.robjects <span class="im">import</span> pandas2ri</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">## Activate conversion between Pandas and R</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>pandas2ri.activate()</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>df_csv <span class="op">=</span> pd.read_csv(<span class="st">"foreign/nyccrashes_cleaned.csv"</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">## Transfer the Pandas DataFrame to R DataFrame</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>df_r <span class="op">=</span> pandas2ri.py2rpy(df_csv)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co">## Save as .Rdata file</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co">## Export the data to the default working directory</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>ro.globalenv[<span class="st">"R"</span>] <span class="op">=</span> df_r</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>ro.r(<span class="st">"save(R, file = 'foreign/nyccrashes_cleaned.Rdata')"</span>)</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"The CSV file has been transfered to a .Rdata file successfully."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><p>The error means : 1.Type conversion failure of columns. Some columns were not converted to the correct data typr in r as epected, and were instead coerced to strings. 2.The data is still saved, but there are potential data type issues. 3.These errores will not influence importing the <code>.Rdata</code> file.</p></li>
<li><p>If you want to perform necessary type cpnversions, the following code is suitable.</p></li>
</ul>
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df_csv[<span class="st">"boroughs"</span>] <span class="op">=</span> df[<span class="st">"boroughs"</span>].astype(<span class="bu">str</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="import-the-generated-.rdata-file" class="level5" data-number="6.2.5.2.2">
<h5 data-number="6.2.5.2.2" class="anchored" data-anchor-id="import-the-generated-.rdata-file"><span class="header-section-number">6.2.5.2.2</span> Import the generated <code>.Rdata</code> file</h5>
<p>We also use the Package <code>rpy2</code>. We need the function <code>pandas2ri</code> too. The code is following</p>
<div id="bd6318c8" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rpy2.robjects <span class="im">as</span> ro</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co">## Load the .Rdata file</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>r_file_path <span class="op">=</span> <span class="st">"foreign/nyccrashes_cleaned.Rdata"</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>ro.r[<span class="st">"load"</span>](r_file_path)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co">## View loaded variables</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>loaded_objects <span class="op">=</span> ro.r(<span class="st">"ls()"</span>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co">## Show the loaded vatiables</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Loaded R objects:"</span>, loaded_objects)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co">## We have set the name of dataframe as "R" above</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>r_dataframe <span class="op">=</span> ro.r[<span class="st">"R"</span>]</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rpy2.robjects <span class="im">import</span> pandas2ri</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="co">## Transfer R Dataframe to Pandas Dataframe </span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="co">## Aim to deal with the data conveniently</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>pandas2ri.activate()</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>df_2 <span class="op">=</span> pandas2ri.rpy2py(r_dataframe)</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Loading custom .RprofileLoaded R objects: [1] "R"

      Unnamed: 0       crash_datetime    borough  zip_code   latitude  \
0              0  2024-06-30 17:30:00       None       NaN        NaN   
1              1  2024-06-30 00:32:00       None       NaN        NaN   
2              2  2024-06-30 07:05:00   BROOKLYN   11235.0  40.581060   
3              3  2024-06-30 20:47:00  MANHATTAN   10021.0  40.763630   
4              4  2024-06-30 10:14:00   BROOKLYN   11222.0  40.730460   
...          ...                  ...        ...       ...        ...   
1870        1870  2024-07-07 21:25:00      BRONX   10457.0  40.852520   
1871        1871  2024-07-07 10:31:00      BRONX   10460.0  40.843945   
1872        1872  2024-07-07 20:15:00     QUEENS   11436.0  40.677982   
1873        1873  2024-07-07 14:45:00      BRONX   10452.0  40.843822   
1874        1874  2024-07-07 14:12:00      BRONX   10468.0  40.861084   

      longitude                 location           on_street_name  \
0           NaN               (0.0, 0.0)                     None   
1           NaN                     None        BELT PARKWAY RAMP   
2    -73.967440    (40.58106, -73.96744)                     None   
3    -73.953300     (40.76363, -73.9533)                FDR DRIVE   
4    -73.951490    (40.73046, -73.95149)        GREENPOINT AVENUE   
...         ...                      ...                      ...   
1870 -73.900020    (40.85252, -73.90002)          EAST 180 STREET   
1871 -73.885800    (40.843945, -73.8858)                     None   
1872 -73.791214  (40.677982, -73.791214)        SUTPHIN BOULEVARD   
1873 -73.927500    (40.843822, -73.9275)  MAJOR DEEGAN EXPRESSWAY   
1874 -73.911490   (40.861084, -73.91149)                     None   

          cross_street_name            off_street_name  ...  \
0                      None                GOLD STREET  ...   
1                      None                       None  ...   
2                      None    2797      OCEAN PARKWAY  ...   
3                      None                       None  ...   
4     MC GUINNESS BOULEVARD                       None  ...   
...                     ...                        ...  ...   
1870                   None                       None  ...   
1871                   None  855       EAST 178 STREET  ...   
1872             120 AVENUE                       None  ...   
1873                   None                       None  ...   
1874                   None    2258      HAMPDEN PLACE  ...   

      contributing_factor_vehicle_2  contributing_factor_vehicle_3  \
0                       Unspecified                           None   
1                       Unspecified                           None   
2                              None                           None   
3                              None                           None   
4                       Unspecified                           None   
...                             ...                            ...   
1870                    Unspecified                           None   
1871                    Unspecified                           None   
1872                    Unspecified                           None   
1873                    Unspecified                           None   
1874                           None                           None   

      contributing_factor_vehicle_4  contributing_factor_vehicle_5  \
0                              None                           None   
1                              None                           None   
2                              None                           None   
3                              None                           None   
4                              None                           None   
...                             ...                            ...   
1870                           None                           None   
1871                           None                           None   
1872                           None                           None   
1873                           None                           None   
1874                           None                           None   

      collision_id                  vehicle_type_code_1  \
0          4736746                                Sedan   
1          4736768  Station Wagon/Sport Utility Vehicle   
2          4737060  Station Wagon/Sport Utility Vehicle   
3          4737510                                Sedan   
4          4736759                                  Bus   
...            ...                                  ...   
1870       4744144                        Pick-up Truck   
1871       4744576  Station Wagon/Sport Utility Vehicle   
1872       4745391                                Sedan   
1873       4746540                                Sedan   
1874       4746320                                Sedan   

                      vehicle_type_code_2  vehicle_type_code_3  \
0                                   Sedan                 None   
1     Station Wagon/Sport Utility Vehicle                 None   
2                                    None                 None   
3                                    None                 None   
4                               Box Truck                 None   
...                                   ...                  ...   
1870                                Sedan                 None   
1871                                 None                 None   
1872                                Sedan                 None   
1873                                Sedan                 None   
1874                                 None                 None   

     vehicle_type_code_4 vehicle_type_code_5  
0                   None                None  
1                   None                None  
2                   None                None  
3                   None                None  
4                   None                None  
...                  ...                 ...  
1870                None                None  
1871                None                None  
1872                None                None  
1873                None                None  
1874                None                None  

[1875 rows x 29 columns]</code></pre>
</div>
</div>
</section>
</section>
<section id="stata-datathe-suffix-of-this-file-is-.dta" class="level4" data-number="6.2.5.3">
<h4 data-number="6.2.5.3" class="anchored" data-anchor-id="stata-datathe-suffix-of-this-file-is-.dta"><span class="header-section-number">6.2.5.3</span> stata data(the suffix of this file is <code>.dta</code>)</h4>
<section id="transfer-the-.csv-file-to-a-.dta-file" class="level5" data-number="6.2.5.3.1">
<h5 data-number="6.2.5.3.1" class="anchored" data-anchor-id="transfer-the-.csv-file-to-a-.dta-file"><span class="header-section-number">6.2.5.3.1</span> Transfer the <code>.csv</code> file to a <code>.dta</code> file</h5>
<p>We can only use <code>Pandas</code>. We choose the fucntion <code>to_stata</code> to save the <code>.dta</code> file.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>df_csv <span class="op">=</span> pd.read_csv(<span class="st">"foreign/nyccrashes_cleaned.csv"</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co">## Export the data to the default working directory</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>df_csv.to_stata(<span class="st">"foreign/stata.dta"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="import-the-.dta-file" class="level5" data-number="6.2.5.3.2">
<h5 data-number="6.2.5.3.2" class="anchored" data-anchor-id="import-the-.dta-file"><span class="header-section-number">6.2.5.3.2</span> Import the <code>.dta</code> file</h5>
<p>We use the function <code>read_stata</code> from <code>Pandas</code>. And here is the specific code.</p>
<div id="c23de67e" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>df_3 <span class="op">=</span> pd.read_stata(<span class="st">"foreign/stata.dta"</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_3.head(<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   index  Unnamed__0       crash_datetime borough  zip_code  latitude  \
0      0           0  2024-06-30 17:30:00               NaN       NaN   
1      1           1  2024-06-30 00:32:00               NaN       NaN   

   longitude    location     on_street_name cross_street_name  ...  \
0        NaN  (0.0, 0.0)                                       ...   
1        NaN              BELT PARKWAY RAMP                    ...   

  contributing_factor_vehicle_2  contributing_factor_vehicle_3  \
0                   Unspecified                                  
1                   Unspecified                                  

   contributing_factor_vehicle_4  contributing_factor_vehicle_5  collision_id  \
0                                                                     4736746   
1                                                                     4736768   

                   vehicle_type_code_1                  vehicle_type_code_2  \
0                                Sedan                                Sedan   
1  Station Wagon/Sport Utility Vehicle  Station Wagon/Sport Utility Vehicle   

   vehicle_type_code_3  vehicle_type_code_4 vehicle_type_code_5  
0                                                                
1                                                                

[2 rows x 30 columns]</code></pre>
</div>
</div>
</section>
</section>
<section id="spss-datathe-suffix-of-this-file-is-.sav" class="level4" data-number="6.2.5.4">
<h4 data-number="6.2.5.4" class="anchored" data-anchor-id="spss-datathe-suffix-of-this-file-is-.sav"><span class="header-section-number">6.2.5.4</span> spss data(the suffix of this file is <code>.sav</code>)</h4>
<section id="transfer-the-.csv-file-to-a-.sav-file" class="level5" data-number="6.2.5.4.1">
<h5 data-number="6.2.5.4.1" class="anchored" data-anchor-id="transfer-the-.csv-file-to-a-.sav-file"><span class="header-section-number">6.2.5.4.1</span> Transfer the <code>.csv</code> file to a <code>.sav</code> file</h5>
<p>We need to use the Package <code>pyreadstat</code> We choose the function <code>write_sav</code> form <code>pyreadstat</code> We are supposed to use the CSV file which is without space. We can uese the following code.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyreadstat</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>df_csv <span class="op">=</span> pd.read_csv(<span class="st">"foreign/Without_Unamed.csv"</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>output_file <span class="op">=</span> os.path.join(<span class="st">"foreign"</span>, <span class="st">"SPSS.sav"</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co">## Export the data to the default working directory</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>pyreadstat.write_sav(df_csv, output_file)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="import-the-generated-.sav-file" class="level5" data-number="6.2.5.4.2">
<h5 data-number="6.2.5.4.2" class="anchored" data-anchor-id="import-the-generated-.sav-file"><span class="header-section-number">6.2.5.4.2</span> Import the generated <code>.sav</code> file</h5>
<p>We also use the Package <code>pyreadstat</code>. We utilize the function <code>read_sav</code> from <code>pyreadstat</code>. The following code helps us import the <code>.sav</code> file.</p>
<div id="6c07c166" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyreadstat</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>df_4, meta <span class="op">=</span> pyreadstat.read_sav(<span class="st">"foreign/SPSS.sav"</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_4.head(<span class="dv">2</span>))</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(meta)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        crash_datetime borough  zip_code  latitude  longitude    location  \
0  2024-06-30 17:30:00               NaN       NaN        NaN  (0.0, 0.0)   
1  2024-06-30 00:32:00               NaN       NaN        NaN               

      on_street_name cross_street_name off_street_name  \
0                                          GOLD STREET   
1  BELT PARKWAY RAMP                                     

   number_of_persons_injured  ...  contributing_factor_vehicle_2  \
0                        0.0  ...                    Unspecified   
1                        0.0  ...                    Unspecified   

   contributing_factor_vehicle_3  contributing_factor_vehicle_4  \
0                                                                 
1                                                                 

   contributing_factor_vehicle_5  collision_id  \
0                                    4736746.0   
1                                    4736768.0   

                   vehicle_type_code_1                  vehicle_type_code_2  \
0                                Sedan                                Sedan   
1  Station Wagon/Sport Utility Vehicle  Station Wagon/Sport Utility Vehicle   

  vehicle_type_code_3 vehicle_type_code_4 vehicle_type_code_5  
0                                                              
1                                                              

[2 rows x 28 columns]
&lt;pyreadstat._readstat_parser.metadata_container object at 0x118b65af0&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="matlab-filesthe-suffix-of-this-file-is-.mat" class="level4" data-number="6.2.5.5">
<h4 data-number="6.2.5.5" class="anchored" data-anchor-id="matlab-filesthe-suffix-of-this-file-is-.mat"><span class="header-section-number">6.2.5.5</span> Matlab files(the suffix of this file is <code>.mat</code>)</h4>
<section id="transfer-the-.csv-file-to-a-.mat-file" class="level5" data-number="6.2.5.5.1">
<h5 data-number="6.2.5.5.1" class="anchored" data-anchor-id="transfer-the-.csv-file-to-a-.mat-file"><span class="header-section-number">6.2.5.5.1</span> Transfer the <code>.csv</code> file to a <code>.mat</code> file</h5>
<p>We need to install the package <code>scipy.io</code></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>pip install scipy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And then we choose the function <code>savemat</code> from <code>scipy</code>. The specific code is following.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.io <span class="im">import</span> savemat</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>df_csv <span class="op">=</span> pd.read_csv(<span class="st">"foreign/nyccrashes_cleaned.csv"</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co">## Convert DataFrame to dicotionary form</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co">## MATLAB.mat require dictionary format</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>data_dict <span class="op">=</span> {<span class="st">"data"</span>: df_csv.to_dict(<span class="st">"list"</span>)}</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co">## Save the dictionary as a .mat file</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>output_file <span class="op">=</span> os.path.join(<span class="st">"foreign"</span>, <span class="st">"MATLAB.mat"</span>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="co">## Export the data to the default working directory</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>savemat(output_file, data_dict)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="import-the-generated-.mat-file" class="level5" data-number="6.2.5.5.2">
<h5 data-number="6.2.5.5.2" class="anchored" data-anchor-id="import-the-generated-.mat-file"><span class="header-section-number">6.2.5.5.2</span> Import the generated <code>.mat</code> file</h5>
<p>We use the Package <code>scipy.io</code> too. We choose the function <code>loadmat</code> from <code>spicy.io</code> And the corresponding code is following.</p>
<div id="84e03b34" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.io <span class="im">import</span> loadmat</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>df_csv <span class="op">=</span> pd.read_csv(<span class="st">"foreign/nyccrashes_cleaned.csv"</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>df_5 <span class="op">=</span> loadmat(<span class="st">"foreign/MATLAB.mat"</span>)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">## Show the data keys</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_5.keys())</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co">## Show the contents of the "data" keys</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_5[<span class="st">"data"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>dict_keys(['__header__', '__version__', '__globals__', 'data'])
[[(array([[   0,    1,    2, ..., 1872, 1873, 1874]]), array(['2024-06-30 17:30:00', '2024-06-30 00:32:00',
         '2024-06-30 07:05:00', ..., '2024-07-07 20:15:00',
         '2024-07-07 14:45:00', '2024-07-07 14:12:00'], dtype='&lt;U19'), array(['nan                             ',
         'nan                             ',
         'BROOKLYN                        ', ...,
         'QUEENS                          ',
         'BRONX                           ',
         'BRONX                           '], dtype='&lt;U32'), array([[   nan,    nan, 11235., ..., 11436., 10452., 10468.]]), array([[      nan,       nan, 40.58106 , ..., 40.677982, 40.843822,
          40.861084]]), array([[       nan,        nan, -73.96744 , ..., -73.791214, -73.9275  ,
          -73.91149 ]]), array(['(0.0, 0.0)                      ',
         'nan                             ',
         '(40.58106, -73.96744)           ', ...,
         '(40.677982, -73.791214)         ',
         '(40.843822, -73.9275)           ',
         '(40.861084, -73.91149)          '], dtype='&lt;U32'), array(['nan                             ',
         'BELT PARKWAY RAMP               ',
         'nan                             ', ...,
         'SUTPHIN BOULEVARD               ',
         'MAJOR DEEGAN EXPRESSWAY         ',
         'nan                             '], dtype='&lt;U32'), array(['nan                             ',
         'nan                             ',
         'nan                             ', ...,
         '120 AVENUE                      ',
         'nan                             ',
         'nan                             '], dtype='&lt;U32'), array(['GOLD STREET                        ',
         'nan                                ',
         '2797      OCEAN PARKWAY            ', ...,
         'nan                                ',
         'nan                                ',
         '2258      HAMPDEN PLACE            '], dtype='&lt;U35'), array([[0, 0, 0, ..., 1, 0, 0]]), array([[0, 0, 0, ..., 0, 0, 0]]), array([[0, 0, 0, ..., 0, 0, 0]]), array([[0, 0, 0, ..., 0, 0, 0]]), array([[0, 0, 0, ..., 0, 0, 0]]), array([[0, 0, 0, ..., 0, 0, 0]]), array([[0, 0, 0, ..., 1, 0, 0]]), array([[0, 0, 0, ..., 0, 0, 0]]), array(['Passing Too Closely                                  ',
         'Unspecified                                          ',
         'Unspecified                                          ', ...,
         'Passing or Lane Usage Improper                       ',
         'Driver Inexperience                                  ',
         'Unspecified                                          '],
        dtype='&lt;U53'), array(['Unspecified                                          ',
         'Unspecified                                          ',
         'nan                                                  ', ...,
         'Unspecified                                          ',
         'Unspecified                                          ',
         'nan                                                  '],
        dtype='&lt;U53'), array(['nan                             ',
         'nan                             ',
         'nan                             ', ...,
         'nan                             ',
         'nan                             ',
         'nan                             '], dtype='&lt;U32'), array(['nan                             ',
         'nan                             ',
         'nan                             ', ...,
         'nan                             ',
         'nan                             ',
         'nan                             '], dtype='&lt;U32'), array(['nan                             ',
         'nan                             ',
         'nan                             ', ...,
         'nan                             ',
         'nan                             ',
         'nan                             '], dtype='&lt;U32'), array([[4736746, 4736768, 4737060, ..., 4745391, 4746540, 4746320]]), array(['Sedan                              ',
         'Station Wagon/Sport Utility Vehicle',
         'Station Wagon/Sport Utility Vehicle', ...,
         'Sedan                              ',
         'Sedan                              ',
         'Sedan                              '], dtype='&lt;U35'), array(['Sedan                              ',
         'Station Wagon/Sport Utility Vehicle',
         'nan                                ', ...,
         'Sedan                              ',
         'Sedan                              ',
         'nan                                '], dtype='&lt;U35'), array(['nan                                ',
         'nan                                ',
         'nan                                ', ...,
         'nan                                ',
         'nan                                ',
         'nan                                '], dtype='&lt;U35'), array(['nan                                ',
         'nan                                ',
         'nan                                ', ...,
         'nan                                ',
         'nan                                ',
         'nan                                '], dtype='&lt;U35'), array(['nan                                ',
         'nan                                ',
         'nan                                ', ...,
         'nan                                ',
         'nan                                ',
         'nan                                '], dtype='&lt;U35'))                                                                                                                                                                                                                                                                                                                                                ]]</code></pre>
</div>
</div>
</section>
</section>
<section id="hdf5-filesthe-suffix-of-this-file-is-.h5" class="level4" data-number="6.2.5.6">
<h4 data-number="6.2.5.6" class="anchored" data-anchor-id="hdf5-filesthe-suffix-of-this-file-is-.h5"><span class="header-section-number">6.2.5.6</span> HDF5 files(the suffix of this file is <code>.h5</code>)</h4>
<section id="transfer-the-.csv-file-to-a-.h5-file" class="level5" data-number="6.2.5.6.1">
<h5 data-number="6.2.5.6.1" class="anchored" data-anchor-id="transfer-the-.csv-file-to-a-.h5-file"><span class="header-section-number">6.2.5.6.1</span> Transfer the <code>.csv</code> file to a <code>.h5</code> file</h5>
<p>We can only use <code>Pandas</code>. At the same time, the function <code>to_hdf</code> helps us achive the goal. The code is following.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tables</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>df_csv <span class="op">=</span> pd.read_csv(<span class="st">"foreign/nyccrashes_cleaned.csv"</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>output_file <span class="op">=</span> os.path.join( <span class="st">"foreign"</span>, <span class="st">"HDF5.h5"</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co">## Export the data to the default working directory</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>df_csv.to_hdf(output_file, key <span class="op">=</span> <span class="st">"data"</span>, mode <span class="op">=</span> <span class="st">"w"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="import-the-generated-.h5-file" class="level5" data-number="6.2.5.6.2">
<h5 data-number="6.2.5.6.2" class="anchored" data-anchor-id="import-the-generated-.h5-file"><span class="header-section-number">6.2.5.6.2</span> Import the generated <code>.h5</code> file</h5>
<p>We only use <code>Pandas</code> too. We need the function <code>read_h5</code>. The code of importing .h5 file is following.</p>
<div id="42bbd0c6" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>df_6 <span class="op">=</span> pd.read_hdf(<span class="st">"foreign/HDF5.h5"</span>, key <span class="op">=</span> <span class="st">"data"</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_6.head(<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Unnamed: 0       crash_datetime borough  zip_code  latitude  longitude  \
0           0  2024-06-30 17:30:00     NaN       NaN       NaN        NaN   
1           1  2024-06-30 00:32:00     NaN       NaN       NaN        NaN   

     location     on_street_name cross_street_name off_street_name  ...  \
0  (0.0, 0.0)                NaN               NaN     GOLD STREET  ...   
1         NaN  BELT PARKWAY RAMP               NaN             NaN  ...   

   contributing_factor_vehicle_2  contributing_factor_vehicle_3  \
0                    Unspecified                            NaN   
1                    Unspecified                            NaN   

   contributing_factor_vehicle_4  contributing_factor_vehicle_5  collision_id  \
0                            NaN                            NaN       4736746   
1                            NaN                            NaN       4736768   

                   vehicle_type_code_1                  vehicle_type_code_2  \
0                                Sedan                                Sedan   
1  Station Wagon/Sport Utility Vehicle  Station Wagon/Sport Utility Vehicle   

   vehicle_type_code_3 vehicle_type_code_4 vehicle_type_code_5  
0                  NaN                 NaN                 NaN  
1                  NaN                 NaN                 NaN  

[2 rows x 29 columns]</code></pre>
</div>
</div>
</section>
</section>
<section id="import-multiple-files-and-merge-them-into-a-new-file" class="level4" data-number="6.2.5.7">
<h4 data-number="6.2.5.7" class="anchored" data-anchor-id="import-multiple-files-and-merge-them-into-a-new-file"><span class="header-section-number">6.2.5.7</span> Import multiple files and merge them into a new file</h4>
<p>I have introduced the method of importing single file of data. Python also allows us to import multiple files simultaneously. We choose the Package <code>glob</code> and Package <code>Pandas</code></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Install Package Glob</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>pip install glob</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The effect of Package <code>glob</code> is to find files and directories that match the specified pattern. We use the function <code>glob</code> from Package <code>glob</code>. The intention of function <code>glob</code> is to find all file paths that match a specitic pattern and return a list of file paths. The following fucntion is the corresponding code.</p>
<div id="bca33f99" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Use the package globe and the package pandas</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glob </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co">## Merge multiple arrays</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co">## * means match any number of characters( including the null characters)</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>all_files <span class="op">=</span> glob.glob(<span class="st">"foreign/*.csv"</span>) </span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co">## Create a list to store the data</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>all_data <span class="op">=</span> []</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co">## Use "for" statement to import all of the csv files</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> filename <span class="kw">in</span> all_files:</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(filename, index_col<span class="op">=</span><span class="va">None</span>, header<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    all_data.append(df)</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="co">## Combine multiple pandas objects into one along a fixed axis using some merging methods</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>data_merge <span class="op">=</span> pd.concat(all_data, axis<span class="op">=</span><span class="dv">0</span>, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="co">## Check the result</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data_merge.head(<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Unnamed: 0       crash_datetime borough  zip_code  latitude  longitude  \
0         0.0  2024-06-30 17:30:00     NaN       NaN       NaN        NaN   
1         1.0  2024-06-30 00:32:00     NaN       NaN       NaN        NaN   

     location     on_street_name cross_street_name off_street_name  ...  \
0  (0.0, 0.0)                NaN               NaN     GOLD STREET  ...   
1         NaN  BELT PARKWAY RAMP               NaN             NaN  ...   

   contributing_factor_vehicle_2  contributing_factor_vehicle_3  \
0                    Unspecified                            NaN   
1                    Unspecified                            NaN   

   contributing_factor_vehicle_4  contributing_factor_vehicle_5  collision_id  \
0                            NaN                            NaN       4736746   
1                            NaN                            NaN       4736768   

                   vehicle_type_code_1                  vehicle_type_code_2  \
0                                Sedan                                Sedan   
1  Station Wagon/Sport Utility Vehicle  Station Wagon/Sport Utility Vehicle   

   vehicle_type_code_3 vehicle_type_code_4 vehicle_type_code_5  
0                  NaN                 NaN                 NaN  
1                  NaN                 NaN                 NaN  

[2 rows x 29 columns]</code></pre>
</div>
</div>
</section>
</section>
<section id="view-data-information" class="level3" data-number="6.2.6">
<h3 data-number="6.2.6" class="anchored" data-anchor-id="view-data-information"><span class="header-section-number">6.2.6</span> View data information</h3>
<p>It is natural for us to be interested in the fundamental information of the data we have imported. As a result, I have listed some useful functions to get the basic knowledge of the data.</p>
<p>The following code helps us know how much the data is. We choose the basic function <code>shape</code> from <code>pandas</code>.</p>
<div id="00a2f11b" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">## How much is the crashes data is</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>df_csv.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>(1875, 29)</code></pre>
</div>
</div>
<ul>
<li>There are 1875 data and 29 columns in the file.</li>
</ul>
<p>The following code helps us check the type of each variable in data. The fucntion is <code>dtypes</code> from <code>Pandas</code></p>
<div id="30d7cc3f" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Show all types of the crashes' variables</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>df_csv.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>Unnamed: 0                         int64
crash_datetime                    object
borough                           object
zip_code                         float64
latitude                         float64
longitude                        float64
location                          object
on_street_name                    object
cross_street_name                 object
off_street_name                   object
number_of_persons_injured          int64
number_of_persons_killed           int64
number_of_pedestrians_injured      int64
number_of_pedestrians_killed       int64
number_of_cyclist_injured          int64
number_of_cyclist_killed           int64
number_of_motorist_injured         int64
number_of_motorist_killed          int64
contributing_factor_vehicle_1     object
contributing_factor_vehicle_2     object
contributing_factor_vehicle_3     object
contributing_factor_vehicle_4     object
contributing_factor_vehicle_5     object
collision_id                       int64
vehicle_type_code_1               object
vehicle_type_code_2               object
vehicle_type_code_3               object
vehicle_type_code_4               object
vehicle_type_code_5               object
dtype: object</code></pre>
</div>
</div>
<ul>
<li>Our computer has listed 29 variables and their corresponding types.</li>
</ul>
<p>The following code is suitable for viewing overall data information. We use the basic function <code>info</code> from <code>Pandas</code></p>
<div id="1880a5d6" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>df_csv.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 1875 entries, 0 to 1874
Data columns (total 29 columns):
 #   Column                         Non-Null Count  Dtype  
---  ------                         --------------  -----  
 0   Unnamed: 0                     1875 non-null   int64  
 1   crash_datetime                 1875 non-null   object 
 2   borough                        1749 non-null   object 
 3   zip_code                       1749 non-null   float64
 4   latitude                       1722 non-null   float64
 5   longitude                      1722 non-null   float64
 6   location                       1729 non-null   object 
 7   on_street_name                 1329 non-null   object 
 8   cross_street_name              943 non-null    object 
 9   off_street_name                546 non-null    object 
 10  number_of_persons_injured      1875 non-null   int64  
 11  number_of_persons_killed       1875 non-null   int64  
 12  number_of_pedestrians_injured  1875 non-null   int64  
 13  number_of_pedestrians_killed   1875 non-null   int64  
 14  number_of_cyclist_injured      1875 non-null   int64  
 15  number_of_cyclist_killed       1875 non-null   int64  
 16  number_of_motorist_injured     1875 non-null   int64  
 17  number_of_motorist_killed      1875 non-null   int64  
 18  contributing_factor_vehicle_1  1864 non-null   object 
 19  contributing_factor_vehicle_2  1425 non-null   object 
 20  contributing_factor_vehicle_3  174 non-null    object 
 21  contributing_factor_vehicle_4  52 non-null     object 
 22  contributing_factor_vehicle_5  14 non-null     object 
 23  collision_id                   1875 non-null   int64  
 24  vehicle_type_code_1            1842 non-null   object 
 25  vehicle_type_code_2            1230 non-null   object 
 26  vehicle_type_code_3            162 non-null    object 
 27  vehicle_type_code_4            48 non-null     object 
 28  vehicle_type_code_5            14 non-null     object 
dtypes: float64(3), int64(10), object(16)
memory usage: 424.9+ KB</code></pre>
</div>
</div>
<ul>
<li>The basic information of crashes data has been listed.</li>
</ul>
<p>The function <code>describe</code> from <code>Pandas</code> helps generate descriptive statistics.</p>
<div id="758d4bd8" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Show the basic descriptive statistics of crashes data</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>df_csv.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Unnamed: 0</th>
<th data-quarto-table-cell-role="th">zip_code</th>
<th data-quarto-table-cell-role="th">latitude</th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">number_of_persons_injured</th>
<th data-quarto-table-cell-role="th">number_of_persons_killed</th>
<th data-quarto-table-cell-role="th">number_of_pedestrians_injured</th>
<th data-quarto-table-cell-role="th">number_of_pedestrians_killed</th>
<th data-quarto-table-cell-role="th">number_of_cyclist_injured</th>
<th data-quarto-table-cell-role="th">number_of_cyclist_killed</th>
<th data-quarto-table-cell-role="th">number_of_motorist_injured</th>
<th data-quarto-table-cell-role="th">number_of_motorist_killed</th>
<th data-quarto-table-cell-role="th">collision_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>1875.000000</td>
<td>1749.000000</td>
<td>1722.000000</td>
<td>1722.000000</td>
<td>1875.000000</td>
<td>1875.000000</td>
<td>1875.000000</td>
<td>1875.000000</td>
<td>1875.000000</td>
<td>1875.0</td>
<td>1875.000000</td>
<td>1875.000000</td>
<td>1.875000e+03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>937.000000</td>
<td>10892.563179</td>
<td>40.719287</td>
<td>-73.919898</td>
<td>0.617067</td>
<td>0.004267</td>
<td>0.093333</td>
<td>0.002667</td>
<td>0.065067</td>
<td>0.0</td>
<td>0.433067</td>
<td>0.001600</td>
<td>4.738587e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>541.410196</td>
<td>525.579066</td>
<td>0.081315</td>
<td>0.085191</td>
<td>0.915610</td>
<td>0.103219</td>
<td>0.338452</td>
<td>0.095207</td>
<td>0.246709</td>
<td>0.0</td>
<td>0.891185</td>
<td>0.039979</td>
<td>1.659947e+03</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>0.000000</td>
<td>10000.000000</td>
<td>40.513510</td>
<td>-74.237366</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.000000</td>
<td>4.736561e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>468.500000</td>
<td>10455.000000</td>
<td>40.662752</td>
<td>-73.968543</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.000000</td>
<td>4.737666e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>937.000000</td>
<td>11208.000000</td>
<td>40.712778</td>
<td>-73.922933</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.000000</td>
<td>4.738257e+06</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>1405.500000</td>
<td>11239.000000</td>
<td>40.767641</td>
<td>-73.869405</td>
<td>1.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.0</td>
<td>1.000000</td>
<td>0.000000</td>
<td>4.738883e+06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>1874.000000</td>
<td>11694.000000</td>
<td>40.907246</td>
<td>-73.702190</td>
<td>11.000000</td>
<td>4.000000</td>
<td>7.000000</td>
<td>4.000000</td>
<td>1.000000</td>
<td>0.0</td>
<td>11.000000</td>
<td>1.000000</td>
<td>4.752444e+06</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>If we want to summarize the names of all columns, it is a good choice to use the function <code>columns</code> from <code>Pandas</code></p>
<div id="3c5cae18" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Get all columns' names of crashes data</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>df_csv.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>Index(['Unnamed: 0', 'crash_datetime', 'borough', 'zip_code', 'latitude',
       'longitude', 'location', 'on_street_name', 'cross_street_name',
       'off_street_name', 'number_of_persons_injured',
       'number_of_persons_killed', 'number_of_pedestrians_injured',
       'number_of_pedestrians_killed', 'number_of_cyclist_injured',
       'number_of_cyclist_killed', 'number_of_motorist_injured',
       'number_of_motorist_killed', 'contributing_factor_vehicle_1',
       'contributing_factor_vehicle_2', 'contributing_factor_vehicle_3',
       'contributing_factor_vehicle_4', 'contributing_factor_vehicle_5',
       'collision_id', 'vehicle_type_code_1', 'vehicle_type_code_2',
       'vehicle_type_code_3', 'vehicle_type_code_4', 'vehicle_type_code_5'],
      dtype='object')</code></pre>
</div>
</div>
<p>The function <code>tail</code> from <code>Pandas</code> allow us to view the last rows.</p>
<div id="31dd8c89" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Show the last 2 rows of crashes data</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>df_csv.tail(n <span class="op">=</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Unnamed: 0</th>
<th data-quarto-table-cell-role="th">crash_datetime</th>
<th data-quarto-table-cell-role="th">borough</th>
<th data-quarto-table-cell-role="th">zip_code</th>
<th data-quarto-table-cell-role="th">latitude</th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">location</th>
<th data-quarto-table-cell-role="th">on_street_name</th>
<th data-quarto-table-cell-role="th">cross_street_name</th>
<th data-quarto-table-cell-role="th">off_street_name</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">contributing_factor_vehicle_2</th>
<th data-quarto-table-cell-role="th">contributing_factor_vehicle_3</th>
<th data-quarto-table-cell-role="th">contributing_factor_vehicle_4</th>
<th data-quarto-table-cell-role="th">contributing_factor_vehicle_5</th>
<th data-quarto-table-cell-role="th">collision_id</th>
<th data-quarto-table-cell-role="th">vehicle_type_code_1</th>
<th data-quarto-table-cell-role="th">vehicle_type_code_2</th>
<th data-quarto-table-cell-role="th">vehicle_type_code_3</th>
<th data-quarto-table-cell-role="th">vehicle_type_code_4</th>
<th data-quarto-table-cell-role="th">vehicle_type_code_5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1873</td>
<td>1873</td>
<td>2024-07-07 14:45:00</td>
<td>BRONX</td>
<td>10452.0</td>
<td>40.843822</td>
<td>-73.92750</td>
<td>(40.843822, -73.9275)</td>
<td>MAJOR DEEGAN EXPRESSWAY</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>Unspecified</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>4746540</td>
<td>Sedan</td>
<td>Sedan</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1874</td>
<td>1874</td>
<td>2024-07-07 14:12:00</td>
<td>BRONX</td>
<td>10468.0</td>
<td>40.861084</td>
<td>-73.91149</td>
<td>(40.861084, -73.91149)</td>
<td>NaN</td>
<td>NaN</td>
<td>2258 HAMPDEN PLACE</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>4746320</td>
<td>Sedan</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>2 rows × 29 columns</p>
</div>
</div>
</div>
<p>The function <code>unique</code> from <code>Pandas</code> dedicates in unique values ​​of one column.</p>
<div id="2f51db0d" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Show the unique values in the column named "crash_datetime"</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>df_csv[<span class="st">"crash_datetime"</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>array(['2024-06-30 17:30:00', '2024-06-30 00:32:00',
       '2024-06-30 07:05:00', ..., '2024-07-07 09:13:00',
       '2024-07-07 10:31:00', '2024-07-07 14:12:00'], dtype=object)</code></pre>
</div>
</div>
<p>We can get the values of one column(without deduplication). The choose of function is <code>values</code> from <code>Pandas</code> instead of <code>unique</code></p>
<div id="28037f29" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Show all values of the column named "crash_datetime"</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>df_csv[<span class="st">"crash_datetime"</span>].values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>array(['2024-06-30 17:30:00', '2024-06-30 00:32:00',
       '2024-06-30 07:05:00', ..., '2024-07-07 20:15:00',
       '2024-07-07 14:45:00', '2024-07-07 14:12:00'], dtype=object)</code></pre>
</div>
</div>
</section>
<section id="find-null-values" class="level3" data-number="6.2.7">
<h3 data-number="6.2.7" class="anchored" data-anchor-id="find-null-values"><span class="header-section-number">6.2.7</span> Find Null Values</h3>
<p>It is necessary for us to find null values before we clean and preprocess the data. The following content covers how to find null values.</p>
<section id="determine-whether-there-are-missing-values." class="level4" data-number="6.2.7.1">
<h4 data-number="6.2.7.1" class="anchored" data-anchor-id="determine-whether-there-are-missing-values."><span class="header-section-number">6.2.7.1</span> Determine whether there are missing values.</h4>
<p>We need to use the function <code>isnull</code> firstly. The aim is to detect missing values in data. And then we add the command <code>any</code> to determine whether there are missing values.</p>
<ul>
<li>Determine whether there are missing values in columns</li>
</ul>
<div id="b2e02c4c" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Determine whether there are missing values in columns of crashes data</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>df_csv.isnull().<span class="bu">any</span>(axis <span class="op">=</span> <span class="dv">0</span>) <span class="co"># "axis=0" means columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>Unnamed: 0                       False
crash_datetime                   False
borough                           True
zip_code                          True
latitude                          True
longitude                         True
location                          True
on_street_name                    True
cross_street_name                 True
off_street_name                   True
number_of_persons_injured        False
number_of_persons_killed         False
number_of_pedestrians_injured    False
number_of_pedestrians_killed     False
number_of_cyclist_injured        False
number_of_cyclist_killed         False
number_of_motorist_injured       False
number_of_motorist_killed        False
contributing_factor_vehicle_1     True
contributing_factor_vehicle_2     True
contributing_factor_vehicle_3     True
contributing_factor_vehicle_4     True
contributing_factor_vehicle_5     True
collision_id                     False
vehicle_type_code_1               True
vehicle_type_code_2               True
vehicle_type_code_3               True
vehicle_type_code_4               True
vehicle_type_code_5               True
dtype: bool</code></pre>
</div>
</div>
<ul>
<li>Determine whether there are missing values ​​in rows.</li>
</ul>
<div id="7e33aa17" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Determine whether there are missing values in rows of crashes data</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>df_csv.isnull().<span class="bu">any</span>(axis <span class="op">=</span> <span class="dv">1</span>) <span class="co"># "axis=1" means rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>0       True
1       True
2       True
3       True
4       True
        ... 
1870    True
1871    True
1872    True
1873    True
1874    True
Length: 1875, dtype: bool</code></pre>
</div>
</div>
</section>
<section id="locate-the-missing-values-of-rowscolumns" class="level4" data-number="6.2.7.2">
<h4 data-number="6.2.7.2" class="anchored" data-anchor-id="locate-the-missing-values-of-rowscolumns"><span class="header-section-number">6.2.7.2</span> Locate the missing values of rows/columns</h4>
<p>We utilize the function <code>loc</code> from <code>Pandas</code>. The function of <code>loc</code> selects or modifies data in a DataFrame or Series. The slection and modification are based on labels.</p>
<ul>
<li>Locate the missing values of rows</li>
</ul>
<div id="b8a2346f" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Locate the missing values in crashes data rows</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>df_csv.loc[df_csv.isnull().<span class="bu">any</span>(axis <span class="op">=</span> <span class="dv">1</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Unnamed: 0</th>
<th data-quarto-table-cell-role="th">crash_datetime</th>
<th data-quarto-table-cell-role="th">borough</th>
<th data-quarto-table-cell-role="th">zip_code</th>
<th data-quarto-table-cell-role="th">latitude</th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">location</th>
<th data-quarto-table-cell-role="th">on_street_name</th>
<th data-quarto-table-cell-role="th">cross_street_name</th>
<th data-quarto-table-cell-role="th">off_street_name</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">contributing_factor_vehicle_2</th>
<th data-quarto-table-cell-role="th">contributing_factor_vehicle_3</th>
<th data-quarto-table-cell-role="th">contributing_factor_vehicle_4</th>
<th data-quarto-table-cell-role="th">contributing_factor_vehicle_5</th>
<th data-quarto-table-cell-role="th">collision_id</th>
<th data-quarto-table-cell-role="th">vehicle_type_code_1</th>
<th data-quarto-table-cell-role="th">vehicle_type_code_2</th>
<th data-quarto-table-cell-role="th">vehicle_type_code_3</th>
<th data-quarto-table-cell-role="th">vehicle_type_code_4</th>
<th data-quarto-table-cell-role="th">vehicle_type_code_5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>2024-06-30 17:30:00</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>(0.0, 0.0)</td>
<td>NaN</td>
<td>NaN</td>
<td>GOLD STREET</td>
<td>...</td>
<td>Unspecified</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>4736746</td>
<td>Sedan</td>
<td>Sedan</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>2024-06-30 00:32:00</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>BELT PARKWAY RAMP</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>Unspecified</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>4736768</td>
<td>Station Wagon/Sport Utility Vehicle</td>
<td>Station Wagon/Sport Utility Vehicle</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2</td>
<td>2024-06-30 07:05:00</td>
<td>BROOKLYN</td>
<td>11235.0</td>
<td>40.581060</td>
<td>-73.967440</td>
<td>(40.58106, -73.96744)</td>
<td>NaN</td>
<td>NaN</td>
<td>2797 OCEAN PARKWAY</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>4737060</td>
<td>Station Wagon/Sport Utility Vehicle</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>3</td>
<td>2024-06-30 20:47:00</td>
<td>MANHATTAN</td>
<td>10021.0</td>
<td>40.763630</td>
<td>-73.953300</td>
<td>(40.76363, -73.9533)</td>
<td>FDR DRIVE</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>4737510</td>
<td>Sedan</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>4</td>
<td>2024-06-30 10:14:00</td>
<td>BROOKLYN</td>
<td>11222.0</td>
<td>40.730460</td>
<td>-73.951490</td>
<td>(40.73046, -73.95149)</td>
<td>GREENPOINT AVENUE</td>
<td>MC GUINNESS BOULEVARD</td>
<td>NaN</td>
<td>...</td>
<td>Unspecified</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>4736759</td>
<td>Bus</td>
<td>Box Truck</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1870</td>
<td>1870</td>
<td>2024-07-07 21:25:00</td>
<td>BRONX</td>
<td>10457.0</td>
<td>40.852520</td>
<td>-73.900020</td>
<td>(40.85252, -73.90002)</td>
<td>EAST 180 STREET</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>Unspecified</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>4744144</td>
<td>Pick-up Truck</td>
<td>Sedan</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1871</td>
<td>1871</td>
<td>2024-07-07 10:31:00</td>
<td>BRONX</td>
<td>10460.0</td>
<td>40.843945</td>
<td>-73.885800</td>
<td>(40.843945, -73.8858)</td>
<td>NaN</td>
<td>NaN</td>
<td>855 EAST 178 STREET</td>
<td>...</td>
<td>Unspecified</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>4744576</td>
<td>Station Wagon/Sport Utility Vehicle</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1872</td>
<td>1872</td>
<td>2024-07-07 20:15:00</td>
<td>QUEENS</td>
<td>11436.0</td>
<td>40.677982</td>
<td>-73.791214</td>
<td>(40.677982, -73.791214)</td>
<td>SUTPHIN BOULEVARD</td>
<td>120 AVENUE</td>
<td>NaN</td>
<td>...</td>
<td>Unspecified</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>4745391</td>
<td>Sedan</td>
<td>Sedan</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1873</td>
<td>1873</td>
<td>2024-07-07 14:45:00</td>
<td>BRONX</td>
<td>10452.0</td>
<td>40.843822</td>
<td>-73.927500</td>
<td>(40.843822, -73.9275)</td>
<td>MAJOR DEEGAN EXPRESSWAY</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>Unspecified</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>4746540</td>
<td>Sedan</td>
<td>Sedan</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1874</td>
<td>1874</td>
<td>2024-07-07 14:12:00</td>
<td>BRONX</td>
<td>10468.0</td>
<td>40.861084</td>
<td>-73.911490</td>
<td>(40.861084, -73.91149)</td>
<td>NaN</td>
<td>NaN</td>
<td>2258 HAMPDEN PLACE</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>4746320</td>
<td>Sedan</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>1875 rows × 29 columns</p>
</div>
</div>
</div>
</section>
<section id="determine-the-number-of-missing-values." class="level4" data-number="6.2.7.3">
<h4 data-number="6.2.7.3" class="anchored" data-anchor-id="determine-the-number-of-missing-values."><span class="header-section-number">6.2.7.3</span> Determine the number of missing values.</h4>
<p>We also use the function <code>isnull</code>. But this time we add the command <code>sum</code> rather than <code>any</code>.</p>
<div id="bd41e3e1" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Calculate the number of missing values in crashes data columns</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>df_csv.isnull().<span class="bu">sum</span>(axis <span class="op">=</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>Unnamed: 0                          0
crash_datetime                      0
borough                           126
zip_code                          126
latitude                          153
longitude                         153
location                          146
on_street_name                    546
cross_street_name                 932
off_street_name                  1329
number_of_persons_injured           0
number_of_persons_killed            0
number_of_pedestrians_injured       0
number_of_pedestrians_killed        0
number_of_cyclist_injured           0
number_of_cyclist_killed            0
number_of_motorist_injured          0
number_of_motorist_killed           0
contributing_factor_vehicle_1      11
contributing_factor_vehicle_2     450
contributing_factor_vehicle_3    1701
contributing_factor_vehicle_4    1823
contributing_factor_vehicle_5    1861
collision_id                        0
vehicle_type_code_1                33
vehicle_type_code_2               645
vehicle_type_code_3              1713
vehicle_type_code_4              1827
vehicle_type_code_5              1861
dtype: int64</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="sql" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="sql"><span class="header-section-number">6.3</span> SQL</h2>
<p>This section was written by Thea Johnson, a senior in Statistics at the time.</p>
<section id="table-of-contents" class="level3" data-number="6.3.1">
<h3 data-number="6.3.1" class="anchored" data-anchor-id="table-of-contents"><span class="header-section-number">6.3.1</span> Table of Contents</h3>
<ul>
<li>What is a Database?</li>
<li>What is SQL</li>
<li>CRUD Model</li>
<li>Creating Tables with SQL</li>
<li>Inserting into SQL Tables</li>
<li>Updating/Deleting SQL Tables</li>
<li>Using SQL to work with NYC Open Data</li>
<li>Queries</li>
</ul>
</section>
<section id="what-is-a-database" class="level3" data-number="6.3.2">
<h3 data-number="6.3.2" class="anchored" data-anchor-id="what-is-a-database"><span class="header-section-number">6.3.2</span> What is a Database?</h3>
<ul>
<li>Collection of related information</li>
<li>Ex: Phone books, grocery list, student records</li>
<li>Relational and non-relational</li>
<li>Relational databases are structured into columns and rows</li>
<li>Each row represents an observation and each column represents an attribute</li>
<li>A key uniquely identifies each row</li>
<li>Trying to input repeat keys causes an error</li>
</ul>
</section>
<section id="example-relational-database" class="level3" data-number="6.3.3">
<h3 data-number="6.3.3" class="anchored" data-anchor-id="example-relational-database"><span class="header-section-number">6.3.3</span> Example Relational Database</h3>
<div id="14f88b03" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sqlite3</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co"># creates a database file called phonebook.db and lets you connect</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>connection <span class="op">=</span> sqlite3.<span class="ex">connect</span>(<span class="st">"phonebook.db"</span>)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="co"># created a cursor object lets you use the cursor function from SQlite3 module</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>cursor <span class="op">=</span> connection.cursor()</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"DROP TABLE IF EXISTS phonebook"</span>)</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Execute function allows you to send commands in the SQL language as strings</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"""</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a><span class="st">CREATE TABLE IF NOT EXISTS phonebook (</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a><span class="st">    phonebook_id INTEGER PRIMARY KEY,</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a><span class="st">    name TEXT,</span></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a><span class="st">    phone_num TEXT UNIQUE,</span></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a><span class="st">    address TEXT</span></span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span>)</span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"INSERT INTO phonebook VALUES (1, 'Greta Colic', '2035452367', '1 Hartsdale road')"</span>)</span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"INSERT INTO phonebook VALUES(2, 'Carlos Alavarez', '9145652761', '13 Porter street')"</span>)</span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"INSERT INTO phonebook VALUES(3, 'Marin Yanko', '5753917568', '110 Ocean avenue')"</span>)</span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"INSERT INTO phonebook VALUES(4, 'Mira Watson', '9146522761', '12 Hindmarsh avenue')"</span>)</span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"INSERT INTO phonebook VALUES(5, 'Harry Smith', '2036658279', '180 Wallace road')"</span>)</span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>connection.commit()</span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a><span class="co"># alternative way of displaying output</span></span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a><span class="co">"""cursor.execute("SELECT * FROM phonebook")</span></span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a><span class="co">rows = cursor.fetchall()</span></span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a><span class="co">for row in rows:</span></span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a><span class="co">    print(row)"""</span></span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a>output <span class="op">=</span> pd.read_sql_query(<span class="st">"SELECT * FROM phonebook"</span>, connection)</span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb63-39"><a href="#cb63-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb63-40"><a href="#cb63-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(output)</span>
<span id="cb63-41"><a href="#cb63-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-42"><a href="#cb63-42" aria-hidden="true" tabindex="-1"></a>connection.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

   phonebook_id             name   phone_num              address
0             1      Greta Colic  2035452367     1 Hartsdale road
1             2  Carlos Alavarez  9145652761     13 Porter street
2             3      Marin Yanko  5753917568     110 Ocean avenue
3             4      Mira Watson  9146522761  12 Hindmarsh avenue
4             5      Harry Smith  2036658279     180 Wallace road</code></pre>
</div>
</div>
</section>
<section id="what-is-sql" class="level3" data-number="6.3.4">
<h3 data-number="6.3.4" class="anchored" data-anchor-id="what-is-sql"><span class="header-section-number">6.3.4</span> What is SQL?</h3>
<ul>
<li>Structured Query Language</li>
<li>Allows users to interact with databases to store and retrieve data</li>
<li>The essential operations follow the CRUD acronym</li>
</ul>
</section>
<section id="crud" class="level3" data-number="6.3.5">
<h3 data-number="6.3.5" class="anchored" data-anchor-id="crud"><span class="header-section-number">6.3.5</span> CRUD</h3>
<ul>
<li>Create, read, update and delete</li>
<li>Essential operations for SQL to manage a database</li>
<li>Create: adds a new record (row) to a database with unique attributes</li>
<li>Read: Returns records based on specified search criteria</li>
<li>Update: Allows you to change attribute(s) of the record</li>
<li>Delete: Allows you to remove records from the database</li>
</ul>
</section>
<section id="implementing-sql-through-python-to-create-a-table" class="level3" data-number="6.3.6">
<h3 data-number="6.3.6" class="anchored" data-anchor-id="implementing-sql-through-python-to-create-a-table"><span class="header-section-number">6.3.6</span> Implementing SQL Through Python to Create a Table</h3>
<div class="sourceCode" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sqlite3</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co"># creates a database file called phonebook.db and lets you connect</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>connection <span class="op">=</span> sqlite3.<span class="ex">connect</span>(<span class="st">"phonebook.db"</span>)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co"># creates a cursor object using the cursor function from SQlite3 module</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>cursor <span class="op">=</span> connection.cursor()</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="co">CREATE TABLE tablename</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="co">(</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="co">    attribute1 datatype PRIMARY KEY,</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a><span class="co">    attribute2 datatype,</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a><span class="co">    attribute3 datatype</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a><span class="co">);</span></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a><span class="co"># You MUST include a primary key to uniquely identify entries</span></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Execute function allows you to send commands in the SQL language as strings</span></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"""</span></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a><span class="st">CREATE TABLE IF NOT EXISTS phonebook (</span></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a><span class="st">    phonebook_id INTEGER PRIMARY KEY,</span></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a><span class="st">    name TEXT NOT NULL,</span></span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a><span class="st">    phone_num TEXT UNIQUE,</span></span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a><span class="st">    address TEXT</span></span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span>)</span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>connection.commit()</span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a>connection.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="how-to-insert-into-the-sql-table" class="level3" data-number="6.3.7">
<h3 data-number="6.3.7" class="anchored" data-anchor-id="how-to-insert-into-the-sql-table"><span class="header-section-number">6.3.7</span> How to Insert into the SQL table?</h3>
<div class="sourceCode" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sqlite3</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Connects the the previously created phonebook.db</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>connection <span class="op">=</span> sqlite3.<span class="ex">connect</span>(<span class="st">"phonebook.db"</span>)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="co"># creates a cursor object using the cursor function from SQlite3 module</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>cursor <span class="op">=</span> connection.cursor()</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="co">INSERT INTO database VALUES("value1", "value2", "value3");</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"INSERT INTO phonebook VALUES (1, 'Greta Colic', '2035452367', '1 Hartsdale road')"</span>)</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"INSERT INTO phonebook VALUES(2, 'Carlos Alavarez', '9145652761', '13 Porter street')"</span>)</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"INSERT INTO phonebook VALUES(3, 'Marin Yanko', '5753917568', '110 Ocean avenue')"</span>)</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"INSERT INTO phonebook VALUES(4, 'Mira Watson', '9146522761', '12 Hindmarsh avenue')"</span>)</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"INSERT INTO phonebook VALUES(5, 'Harry Smith', '2036658279', '180 Wallace road')"</span>)</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a><span class="co"># How to input data if there's a missing value?</span></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a><span class="co">INSERT INTO database(attribute1, attribute2) VALUES(val1, val2);</span></span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a><span class="co"># only works if the missing value is not a primary key</span></span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"INSERT INTO phonebook(phonebook_id, name, phone_num) VALUES(6, 'Stacy Yang', '9178852765')"</span>)</span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>connection.commit()</span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Allows you to see the created table</span></span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a>output <span class="op">=</span> pd.read_sql_query(<span class="st">"SELECT * FROM phonebook"</span>, connection)</span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(output)</span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a>connection.close()</span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="how-to-updatedelete-using-sql" class="level3" data-number="6.3.8">
<h3 data-number="6.3.8" class="anchored" data-anchor-id="how-to-updatedelete-using-sql"><span class="header-section-number">6.3.8</span> How to Update/Delete Using SQL?</h3>
<div class="sourceCode" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Updating an attribute (WHERE statement is optional)</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>connection <span class="op">=</span> sqlite3.<span class="ex">connect</span>(<span class="st">"phonebook.db"</span>)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co"># created a cursor object lets you use the cursor function from SQlite3 module</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>cursor <span class="op">=</span> connection.cursor()</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Updates Greta's number</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"UPDATE phonebook SET phone_num = '2035151234' WHERE name = 'Greta Colic';"</span>)</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Deletes Harry Smith from the phonebook</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"DELETE FROM phonebook WHERE name = 'Harry Smith';"</span>)</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Changes Carlos's last name</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"UPDATE phonebook SET name = 'Carlos Ramos' WHERE name = 'Carlos Alavarez';"</span>)</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Updating multiple columns</span></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>update_multiple_query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a><span class="st">UPDATE phonebook </span></span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a><span class="st">SET phone_num = '7777777777', address = '45 Main St' </span></span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a><span class="st">WHERE name = 'Marin Yanko';</span></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>cursor.execute(update_multiple_query)</span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a><span class="co"># deleting a table </span></span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"DROP TABLE phonebook;"</span>)</span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a>connection.commit()</span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a>connection.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="section" class="level3" data-number="6.3.9">
<h3 data-number="6.3.9" class="anchored" data-anchor-id="section"><span class="header-section-number">6.3.9</span> </h3>
<div id="cef263fa" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sqlite3</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co"># creates a database file called phonebook.db and lets you connect</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>connection <span class="op">=</span> sqlite3.<span class="ex">connect</span>(<span class="st">"phonebook.db"</span>)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="co"># created a cursor object lets you use the cursor function from SQlite3 module</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>cursor <span class="op">=</span> connection.cursor()</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"DROP TABLE IF EXISTS phonebook;"</span>)</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Execute function allows you to send commands in the SQL language as strings</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"""</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a><span class="st">CREATE TABLE IF NOT EXISTS phonebook (</span></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a><span class="st">    phonebook_id INT,</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a><span class="st">    name VARCHAR(30), </span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a><span class="st">    phone_num VARCHAR(15) PRIMARY KEY,</span></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a><span class="st">    address VARCHAR(30)</span></span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a><span class="st">)</span></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span>)</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"INSERT INTO phonebook VALUES (1, 'Greta Colic', '2035452367', '1 Hartsdale road')"</span>)</span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"INSERT INTO phonebook VALUES(2, 'Carlos Alavarez', '9145652761', '13 Porter street')"</span>)</span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"INSERT INTO phonebook VALUES(3, 'Marin Yanko', '5753917568', '110 Ocean avenue')"</span>)</span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"INSERT INTO phonebook VALUES(4, 'Mira Watson', '9146522761', '12 Hindmarsh avenue')"</span>)</span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"INSERT INTO phonebook VALUES(5, 'Harry Smith', '2036658279', '180 Wallace road')"</span>)</span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"INSERT INTO phonebook(phonebook_id, name, phone_num) VALUES(6, 'Stacy Yang', '9178852765')"</span>)</span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>connection.commit()</span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a><span class="co"># alternative way of displaying output</span></span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a><span class="co">"""cursor.execute("SELECT * FROM phonebook")</span></span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a><span class="co">rows = cursor.fetchall()</span></span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a><span class="co">for row in rows:</span></span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a><span class="co">    print(row)"""</span></span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-37"><a href="#cb68-37" aria-hidden="true" tabindex="-1"></a>output <span class="op">=</span> pd.read_sql_query(<span class="st">"SELECT * FROM phonebook"</span>, connection)</span>
<span id="cb68-38"><a href="#cb68-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(output)</span>
<span id="cb68-39"><a href="#cb68-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">" "</span>)</span>
<span id="cb68-40"><a href="#cb68-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">" "</span>)</span>
<span id="cb68-41"><a href="#cb68-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-42"><a href="#cb68-42" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"UPDATE phonebook SET phone_num = '2035151234' WHERE name = 'Greta Colic';"</span>)</span>
<span id="cb68-43"><a href="#cb68-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-44"><a href="#cb68-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Deletes Harry Smith from the phonebook</span></span>
<span id="cb68-45"><a href="#cb68-45" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"DELETE FROM phonebook WHERE name = 'Harry Smith';"</span>)</span>
<span id="cb68-46"><a href="#cb68-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-47"><a href="#cb68-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Updating multiple columns</span></span>
<span id="cb68-48"><a href="#cb68-48" aria-hidden="true" tabindex="-1"></a>update_multiple_query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb68-49"><a href="#cb68-49" aria-hidden="true" tabindex="-1"></a><span class="st">UPDATE phonebook </span></span>
<span id="cb68-50"><a href="#cb68-50" aria-hidden="true" tabindex="-1"></a><span class="st">SET phone_num = '7777777777', address = '45 Main St' </span></span>
<span id="cb68-51"><a href="#cb68-51" aria-hidden="true" tabindex="-1"></a><span class="st">WHERE name = 'Marin Yanko';</span></span>
<span id="cb68-52"><a href="#cb68-52" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="cb68-53"><a href="#cb68-53" aria-hidden="true" tabindex="-1"></a>cursor.execute(update_multiple_query)</span>
<span id="cb68-54"><a href="#cb68-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-55"><a href="#cb68-55" aria-hidden="true" tabindex="-1"></a>cursor.execute(<span class="st">"UPDATE phonebook SET name = 'Carlos Ramos' WHERE name = 'Carlos Alavarez';"</span>)</span>
<span id="cb68-56"><a href="#cb68-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-57"><a href="#cb68-57" aria-hidden="true" tabindex="-1"></a>connection.commit()</span>
<span id="cb68-58"><a href="#cb68-58" aria-hidden="true" tabindex="-1"></a>output <span class="op">=</span> pd.read_sql_query(<span class="st">"SELECT * FROM phonebook"</span>, connection)</span>
<span id="cb68-59"><a href="#cb68-59" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(output)</span>
<span id="cb68-60"><a href="#cb68-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-61"><a href="#cb68-61" aria-hidden="true" tabindex="-1"></a>connection.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   phonebook_id             name   phone_num              address
0             1      Greta Colic  2035452367     1 Hartsdale road
1             2  Carlos Alavarez  9145652761     13 Porter street
2             3      Marin Yanko  5753917568     110 Ocean avenue
3             4      Mira Watson  9146522761  12 Hindmarsh avenue
4             5      Harry Smith  2036658279     180 Wallace road
5             6       Stacy Yang  9178852765                 None
 
 
   phonebook_id          name   phone_num              address
0             1   Greta Colic  2035151234     1 Hartsdale road
1             2  Carlos Ramos  9145652761     13 Porter street
2             3   Marin Yanko  7777777777           45 Main St
3             4   Mira Watson  9146522761  12 Hindmarsh avenue
4             6    Stacy Yang  9178852765                 None</code></pre>
</div>
</div>
</section>
<section id="using-sql-to-work-on-a-csv-file" class="level3" data-number="6.3.10">
<h3 data-number="6.3.10" class="anchored" data-anchor-id="using-sql-to-work-on-a-csv-file"><span class="header-section-number">6.3.10</span> Using SQL to Work on a CSV file</h3>
<div class="sourceCode" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sqlite3</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Creates an SQL Database</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>conn <span class="op">=</span> sqlite3.<span class="ex">connect</span>(<span class="st">"nyc.db"</span>)</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Reads the CSV file using the path</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(<span class="vs">r"data/nyccrashes_2024w0630_by20240916.csv"</span>)</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>cursor <span class="op">=</span> conn.cursor()</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a><span class="co"># automatically converts data to an SQL table</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>data.to_sql(<span class="st">'nyccrashes'</span>, conn, if_exists<span class="op">=</span><span class="st">'replace'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="24b5e160" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sqlite3</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Creates an SQL Database</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>conn <span class="op">=</span> sqlite3.<span class="ex">connect</span>(<span class="st">"nyc.db"</span>)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Reads the CSV file using the path</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(<span class="vs">r"data/nyccrashes_2024w0630_by20240916.csv"</span>)</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>cursor <span class="op">=</span> conn.cursor()</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a><span class="co"># automatically converts data to an SQL table</span></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>data.to_sql(<span class="st">'nyccrashes'</span>, conn, if_exists<span class="op">=</span><span class="st">'replace'</span>, index<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>1875</code></pre>
</div>
</div>
</section>
<section id="queries" class="level3" data-number="6.3.11">
<h3 data-number="6.3.11" class="anchored" data-anchor-id="queries"><span class="header-section-number">6.3.11</span> Queries</h3>
<ul>
<li>Commands used to pull needed data out of a database</li>
</ul>
<div class="sourceCode" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Query for everythin in the table</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>query1 <span class="op">=</span> pd.read_sql_query(<span class="st">"SELECT * FROM nyccrashes;"</span>, conn)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(query1.head(<span class="dv">3</span>))</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Query to count total crashes</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>total_crashes <span class="op">=</span> pd.read_sql_query(<span class="st">"SELECT COUNT(*) FROM nyccrashes;"</span>, conn)</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(total_crashes)</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Query to only retrieve fixed attributes</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>specific_columns <span class="op">=</span> pd.read_sql_query(<span class="st">"SELECT </span><span class="ch">\"</span><span class="st">ZIP CODE</span><span class="ch">\"</span><span class="st">, </span><span class="ch">\"</span><span class="st">CRASH TIME</span><span class="ch">\"</span><span class="st"> FROM nyccrashes;"</span>, conn)</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(specific_columns.head(<span class="dv">3</span>))</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Groups Crashes by borough</span></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>crashes_by_borough <span class="op">=</span> pd.read_sql_query(<span class="st">"""</span></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a><span class="st">    SELECT BOROUGH, COUNT(*) AS Total_Crashes</span></span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a><span class="st">    FROM nyccrashes</span></span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a><span class="st">    GROUP BY BOROUGH;</span></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span>, conn)</span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(crashes_by_borough)</span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Query to show the fatal crashes</span></span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a>fatal_crashes <span class="op">=</span> pd.read_sql_query(<span class="st">"SELECT * FROM nyccrashes WHERE </span><span class="ch">\"</span><span class="st">NUMBER OF PERSONS KILLED</span><span class="ch">\"</span><span class="st"> &gt; 0;"</span>, conn)</span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(fatal_crashes.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="queries-output" class="level3" data-number="6.3.12">
<h3 data-number="6.3.12" class="anchored" data-anchor-id="queries-output"><span class="header-section-number">6.3.12</span> Queries Output</h3>
<div id="a76d0a1f" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Query for everythin in the table</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="co"># query1 = pd.read_sql_query("SELECT * FROM nyccrashes;", conn)</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="co"># print(query1.head(3))</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Query to count total crashes</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Here's the output for the count query."</span>)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>total_crashes <span class="op">=</span> pd.read_sql_query(<span class="st">"SELECT COUNT(*) FROM nyccrashes;"</span>, conn)</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(total_crashes)</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Groups Crashes by borough</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Here's the output for the query to group crashes by borough."</span>)</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>crashes_by_borough <span class="op">=</span> pd.read_sql_query(<span class="st">"""</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a><span class="st">    SELECT BOROUGH, COUNT(*) AS Total_Crashes</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a><span class="st">    FROM nyccrashes</span></span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a><span class="st">    GROUP BY BOROUGH;</span></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span>, conn)</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(crashes_by_borough)</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Query to only retrieve fixed attributes</span></span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Here's the output for the specific columns query."</span>)</span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>specific_columns <span class="op">=</span> pd.read_sql_query(<span class="st">"SELECT </span><span class="ch">\"</span><span class="st">ZIP CODE</span><span class="ch">\"</span><span class="st">, </span><span class="ch">\"</span><span class="st">CRASH TIME</span><span class="ch">\"</span><span class="st"> FROM nyccrashes;"</span>, conn)</span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(specific_columns.head(<span class="dv">5</span>))</span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Query to show the fatal crashes</span></span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a><span class="co"># fatal_crashes = pd.read_sql_query("SELECT * FROM nyccrashes #WHERE \"NUMBER OF PERSONS KILLED\" &gt; 0;", conn)</span></span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a><span class="co"># print(fatal_crashes.head())</span></span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a>conn.commit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Here's the output for the count query.
   COUNT(*)
0      1875

Here's the output for the query to group crashes by borough.
         BOROUGH  Total_Crashes
0           None            541
1          BRONX            213
2       BROOKLYN            462
3      MANHATTAN            228
4         QUEENS            381
5  STATEN ISLAND             50

Here's the output for the specific columns query.
   ZIP CODE CRASH TIME
0       NaN      17:30
1       NaN       0:32
2   11235.0       7:05
3       NaN      20:47
4   11222.0      10:14</code></pre>
</div>
</div>
</section>
<section id="conclusion" class="level3" data-number="6.3.13">
<h3 data-number="6.3.13" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">6.3.13</span> Conclusion</h3>
<ul>
<li>SQL works with relational databases</li>
<li>SQL performs the CRUD functions: create, read, update, and delete to work with databases</li>
<li>A query is a request from a database for information</li>
<li>SQL can be used to manipulate data from various formats including CSV files</li>
</ul>
</section>
<section id="further-reading" class="level3" data-number="6.3.14">
<h3 data-number="6.3.14" class="anchored" data-anchor-id="further-reading"><span class="header-section-number">6.3.14</span> Further reading</h3>
<ul>
<li>Python Software Foundation. (n.d.). sqlite3 — DB-API 2.0 interface for SQLite databases. Python Documentation. <a href="https://docs.python.org/3/library/sqlite3.html" class="uri">https://docs.python.org/3/library/sqlite3.html</a></li>
</ul>
</section>
</section>
<section id="nyc-crash-data" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="nyc-crash-data"><span class="header-section-number">6.4</span> NYC Crash Data</h2>
<p>Consider a subset of the NYC Crash Data, which contains all NYC motor vehicle collisions data with documentation from <a href="https://data.cityofnewyork.us/Public-Safety/Motor-Vehicle-Collisions-Crashes/h9gi-nx95">NYC Open Data</a>. We downloaded the crash data for the week of June 30, 2024, on September 16, 2024, in CSC format.</p>
<div id="a68df2f8" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the dataset</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>file_path <span class="op">=</span> <span class="st">'data/nyccrashes_2024w0630_by20240916.csv'</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(file_path)</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace column names: convert to lowercase and replace spaces with underscores</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>df.columns <span class="op">=</span> df.columns.<span class="bu">str</span>.lower().<span class="bu">str</span>.replace(<span class="st">' '</span>, <span class="st">'_'</span>)</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first few rows of the dataset to understand its structure</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">crash_date</th>
<th data-quarto-table-cell-role="th">crash_time</th>
<th data-quarto-table-cell-role="th">borough</th>
<th data-quarto-table-cell-role="th">zip_code</th>
<th data-quarto-table-cell-role="th">latitude</th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">location</th>
<th data-quarto-table-cell-role="th">on_street_name</th>
<th data-quarto-table-cell-role="th">cross_street_name</th>
<th data-quarto-table-cell-role="th">off_street_name</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">contributing_factor_vehicle_2</th>
<th data-quarto-table-cell-role="th">contributing_factor_vehicle_3</th>
<th data-quarto-table-cell-role="th">contributing_factor_vehicle_4</th>
<th data-quarto-table-cell-role="th">contributing_factor_vehicle_5</th>
<th data-quarto-table-cell-role="th">collision_id</th>
<th data-quarto-table-cell-role="th">vehicle_type_code_1</th>
<th data-quarto-table-cell-role="th">vehicle_type_code_2</th>
<th data-quarto-table-cell-role="th">vehicle_type_code_3</th>
<th data-quarto-table-cell-role="th">vehicle_type_code_4</th>
<th data-quarto-table-cell-role="th">vehicle_type_code_5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>06/30/2024</td>
<td>17:30</td>
<td>NaN</td>
<td>NaN</td>
<td>0.00000</td>
<td>0.00000</td>
<td>(0.0, 0.0)</td>
<td>NaN</td>
<td>NaN</td>
<td>GOLD STREET</td>
<td>...</td>
<td>Unspecified</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>4736746</td>
<td>Sedan</td>
<td>Sedan</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>06/30/2024</td>
<td>0:32</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>BELT PARKWAY RAMP</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>Unspecified</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>4736768</td>
<td>Station Wagon/Sport Utility Vehicle</td>
<td>Station Wagon/Sport Utility Vehicle</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>06/30/2024</td>
<td>7:05</td>
<td>BROOKLYN</td>
<td>11235.0</td>
<td>40.58106</td>
<td>-73.96744</td>
<td>(40.58106, -73.96744)</td>
<td>NaN</td>
<td>NaN</td>
<td>2797 OCEAN PARKWAY</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>4737060</td>
<td>Station Wagon/Sport Utility Vehicle</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>06/30/2024</td>
<td>20:47</td>
<td>NaN</td>
<td>NaN</td>
<td>40.76363</td>
<td>-73.95330</td>
<td>(40.76363, -73.9533)</td>
<td>FDR DRIVE</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>4737510</td>
<td>Sedan</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>06/30/2024</td>
<td>10:14</td>
<td>BROOKLYN</td>
<td>11222.0</td>
<td>40.73046</td>
<td>-73.95149</td>
<td>(40.73046, -73.95149)</td>
<td>GREENPOINT AVENUE</td>
<td>MC GUINNESS BOULEVARD</td>
<td>NaN</td>
<td>...</td>
<td>Unspecified</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>4736759</td>
<td>Bus</td>
<td>Box Truck</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>5 rows × 29 columns</p>
</div>
</div>
</div>
<p>Now we can do some cleaning after a quick browse.</p>
<div id="fe5c8a1c" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace invalid coordinates (latitude=0, longitude=0 or NaN) with NaN</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>df.loc[(df[<span class="st">'latitude'</span>] <span class="op">==</span> <span class="dv">0</span>) <span class="op">&amp;</span> (df[<span class="st">'longitude'</span>] <span class="op">==</span> <span class="dv">0</span>), </span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>       [<span class="st">'latitude'</span>, <span class="st">'longitude'</span>]] <span class="op">=</span> pd.NA</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'latitude'</span>] <span class="op">=</span> df[<span class="st">'latitude'</span>].replace(<span class="dv">0</span>, pd.NA)</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'longitude'</span>] <span class="op">=</span> df[<span class="st">'longitude'</span>].replace(<span class="dv">0</span>, pd.NA)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Longitude/latitude don't need double precision</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'latitude'</span>] <span class="op">=</span> df[<span class="st">'latitude'</span>].astype(<span class="st">'float32'</span>, errors<span class="op">=</span><span class="st">'ignore'</span>)</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'longitude'</span>] <span class="op">=</span> df[<span class="st">'longitude'</span>].astype(<span class="st">'float32'</span>, errors<span class="op">=</span><span class="st">'ignore'</span>)</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop the redundant 'location' column</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(columns<span class="op">=</span>[<span class="st">'location'</span>])</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting 'crash_date' and 'crash_time' columns into a single datetime column</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'crash_datetime'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'crash_date'</span>] <span class="op">+</span> <span class="st">' '</span> </span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>                       <span class="op">+</span> df[<span class="st">'crash_time'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%m/</span><span class="sc">%d</span><span class="st">/%Y %H:%M'</span>, errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop the original 'crash_date' and 'crash_time' columns</span></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(columns<span class="op">=</span>[<span class="st">'crash_date'</span>, <span class="st">'crash_time'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Are missing in zip code and borough always co-occur?</p>
<div id="ce160bb5" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if missing values in 'zip_code' and 'borough' always co-occur</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Count rows where both are missing</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>missing_cooccur <span class="op">=</span> df[[<span class="st">'zip_code'</span>, <span class="st">'borough'</span>]].isnull().<span class="bu">all</span>(axis<span class="op">=</span><span class="dv">1</span>).<span class="bu">sum</span>()</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Count total missing in 'zip_code' and 'borough', respectively</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>total_missing_zip_code <span class="op">=</span> df[<span class="st">'zip_code'</span>].isnull().<span class="bu">sum</span>()</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>total_missing_borough <span class="op">=</span> df[<span class="st">'borough'</span>].isnull().<span class="bu">sum</span>()</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="co"># If missing in both columns always co-occur, the number of missing</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a><span class="co"># co-occurrences should be equal to the total missing in either column</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>missing_cooccur, total_missing_zip_code, total_missing_borough</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>(np.int64(541), np.int64(541), np.int64(541))</code></pre>
</div>
</div>
<p>Are there cases where zip_code and borough are missing but the geo codes are not missing? If so, fill in <code>zip_code</code> and <code>borough</code> using the geo codes by reverse geocoding.</p>
<p>First make sure <code>geopy</code> is installed.</p>
<pre class="shell"><code>pip install geopy</code></pre>
<p>Now we use model <code>Nominatim</code> in package <code>geopy</code> to reverse geocode.</p>
<div id="c7ff3c69" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> geopy.geocoders <span class="im">import</span> Nominatim</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the geocoder; the `user_agent` is your identifier </span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="co"># when using the service. Be mindful not to crash the server</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="co"># by unlimited number of queries, especially invalid code.</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>geolocator <span class="op">=</span> Nominatim(user_agent<span class="op">=</span><span class="st">"jyGeopyTry"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We write a function to do the reverse geocoding given lattitude and longitude.</p>
<div id="51ce5790" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to fill missing zip_code</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_zip_code(latitude, longitude):</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>        location <span class="op">=</span> geolocator.reverse((latitude, longitude), timeout<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> location:</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>            address <span class="op">=</span> location.raw[<span class="st">'address'</span>]</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>            zip_code <span class="op">=</span> address.get(<span class="st">'postcode'</span>, <span class="va">None</span>)</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> zip_code</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss"> for coordinates </span><span class="sc">{</span>latitude<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>longitude<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">finally</span>:</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="dv">1</span>)  <span class="co"># Delay to avoid overwhelming the service</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s try it out:</p>
<div id="32754532" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>latitude <span class="op">=</span> <span class="fl">40.730610</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>longitude <span class="op">=</span> <span class="op">-</span><span class="fl">73.935242</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>zip_code <span class="op">=</span> get_zip_code(latitude, longitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The function <code>get_zip_code</code> can then be applied to rows where zip code is missing but geocodes are not to fill the missing zip code.</p>
<p>Once zip code is known, figuring out <code>burough</code> is simple because valid zip codes from each borough are known.</p>
</section>
<section id="cross-platform-data-format-arrow" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="cross-platform-data-format-arrow"><span class="header-section-number">6.5</span> Cross-platform Data Format <code>Arrow</code></h2>
<p>The CSV format (and related formats like TSV - tab-separated values) for data tables is ubiquitous, convenient, and can be read or written by many different data analysis environments, including spreadsheets. An advantage of the textual representation of the data in a CSV file is that the entire data table, or portions of it, can be previewed in a text editor. However, the textual representation can be ambiguous and inconsistent. The format of a particular column: Boolean, integer, floating-point, text, factor, etc. must be inferred from text representation, often at the expense of reading the entire file before these inferences can be made. Experienced data scientists are aware that a substantial part of an analysis or report generation is often the “data cleaning” involved in preparing the data for analysis. This can be an open-ended task — it required numerous trial-and-error iterations to create the list of different missing data representations we use for the sample CSV file and even now we are not sure we have them all.</p>
<p>To read and export data efficiently, leveraging the Apache <code>Arrow</code> library can significantly improve performance and storage efficiency, especially with large datasets. The IPC (Inter-Process Communication) file format in the context of Apache Arrow is a key component for efficiently sharing data between different processes, potentially written in different programming languages. Arrow’s IPC mechanism is designed around two main file formats:</p>
<ul>
<li>Stream Format: For sending an arbitrary length sequence of Arrow record batches (tables). The stream format is useful for real-time data exchange where the size of the data is not known upfront and can grow indefinitely.</li>
<li>File (or Feather) Format: Optimized for storage and memory-mapped access, allowing for fast random access to different sections of the data. This format is ideal for scenarios where the entire dataset is available upfront and can be stored in a file system for repeated reads and writes.</li>
</ul>
<p>Apache Arrow provides a columnar memory format for flat and hierarchical data, optimized for efficient data analytics. It can be used in Python through the <code>pyarrow</code> package. Here’s how you can use Arrow to read, manipulate, and export data, including a demonstration of storage savings.</p>
<p>First, ensure you have <code>pyarrow</code> installed on your computer (and preferrably, in your current virtual environment):</p>
<pre class="shell"><code>pip install pyarrow</code></pre>
<p>Feather is a fast, lightweight, and easy-to-use binary file format for storing data frames, optimized for speed and efficiency, particularly for IPC and data sharing between Python and R or Julia.</p>
<div id="be93c033" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>df.to_feather(<span class="st">'data/nyccrashes_cleaned.feather'</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the file sizes of the feather format and the CSV format</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="co"># File paths</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>csv_file <span class="op">=</span> <span class="st">'data/nyccrashes_2024w0630_by20240916.csv'</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>feather_file <span class="op">=</span> <span class="st">'data/nyccrashes_cleaned.feather'</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Get file sizes in bytes</span></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>csv_size <span class="op">=</span> os.path.getsize(csv_file)</span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>feather_size <span class="op">=</span> os.path.getsize(feather_file)</span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert bytes to a more readable format (e.g., MB)</span></span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>csv_size_mb <span class="op">=</span> csv_size <span class="op">/</span> (<span class="dv">1024</span> <span class="op">*</span> <span class="dv">1024</span>)</span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>feather_size_mb <span class="op">=</span> feather_size <span class="op">/</span> (<span class="dv">1024</span> <span class="op">*</span> <span class="dv">1024</span>)</span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the file sizes</span></span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"CSV file size: </span><span class="sc">{</span>csv_size_mb<span class="sc">:.2f}</span><span class="ss"> MB"</span>)</span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Feather file size: </span><span class="sc">{</span>feather_size_mb<span class="sc">:.2f}</span><span class="ss"> MB"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Read the feather file back in:</p>
<div id="b755ab2a" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>dff <span class="op">=</span> pd.read_feather(<span class="st">"data/nyccrashes_cleaned.feather"</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>dff.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="using-the-census-data" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="using-the-census-data"><span class="header-section-number">6.6</span> Using the Census Data</h2>
<p>The <a href="data.census.gov">US Census</a> provides a lot of useful data that could be merged with the NYC crash data for further analytics.</p>
<p>First, ensure the DataFrame (df) is ready for merging with census data. Specifically, check that the <code>zip_code</code> column is clean and consistent.and consistent.</p>
<div id="57ab0de2" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_feather(<span class="st">"data/nyccrashes_cleaned.feather"</span>)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>valid_zip_df <span class="op">=</span> df.dropna(subset<span class="op">=</span>[<span class="st">'zip_code'</span>]).copy()</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>valid_zip_df[<span class="st">'zip_code'</span>] <span class="op">=</span> valid_zip_df[<span class="st">'zip_code'</span>].astype(<span class="bu">int</span>).astype(<span class="bu">str</span>).<span class="bu">str</span>.zfill(<span class="dv">5</span>)</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>unique_zips <span class="op">=</span> valid_zip_df[<span class="st">'zip_code'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can use the <code>uszipcode</code> package to get basic demographic data for each zip code. For more detailed or specific census data, using the <code>CensusData</code> package or direct API calls to the Census Bureau’s API.</p>
<p>The <code>uszipcode</code> package provides a range of information about ZIP codes in the United States. When you query a ZIP code using <code>uszipcode</code>, you can access various attributes related to demographic data, housing, geographic location, and more. Here are some of the key variables available at the ZIP code level:</p>
<p><strong>Demographic Information</strong></p>
<ul>
<li><code>population</code>: The total population.</li>
<li><code>population_density</code>: The population per square kilometer.</li>
<li><code>housing_units</code>: The total number of housing units.</li>
<li><code>occupied_housing_units</code>: The number of occupied housing units.</li>
<li><code>median_home_value</code>: The median value of homes.</li>
<li><code>median_household_income</code>: The median household income.</li>
<li><code>age_distribution</code>: A breakdown of the population by age.</li>
</ul>
<p><strong>Geographic Information</strong></p>
<ul>
<li><code>zipcode</code>: The ZIP code.</li>
<li><code>zipcode_type</code>: The type of ZIP code (e.g., Standard, PO Box).</li>
<li><code>major_city</code>: The major city associated with the ZIP code.</li>
<li><code>post_office_city</code>: The city name recognized by the U.S. Postal Service.</li>
<li><code>common_city_list</code>: A list of common city names for the ZIP code.</li>
<li><code>county</code>: The county in which the ZIP code is located.</li>
<li><code>state</code>: The state in which the ZIP code is located.</li>
<li><code>lat</code>: The latitude of the approximate center of the ZIP code.</li>
<li><code>lng</code>: The longitude of the approximate center of the ZIP code.</li>
<li><code>timezone</code>: The timezone of the ZIP code.</li>
</ul>
<p><strong>Economic and Housing Data</strong></p>
<ul>
<li><code>land_area_in_sqmi</code>: The land area in square miles.</li>
<li><code>water_area_in_sqmi</code>: The water area in square miles.</li>
<li><code>occupancy_rate</code>: The rate of occupancy for housing units.</li>
<li><code>median_age</code>: The median age of the population.</li>
</ul>
<p>Install the <code>uszipcode</code> package into the current virtual environment, if it has not been installd yet.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install uszipcode</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="kw">``</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="ex">We</span> will first clean the <span class="kw">`</span><span class="ex">zip_code</span><span class="kw">`</span> column to ensure it only</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a><span class="ex">contains</span> valid ZIP codes. Then, we will use a vectorized</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="ex">approach</span> to fetch the required data for each unique zip code</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a><span class="ex">and</span> merge this information back into the original <span class="kw">`</span><span class="ex">DataFrame</span><span class="kw">`</span>.</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a><span class="kw">`</span><span class="ex">{python}</span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove rows where 'zip_code' is missing or not a valid ZIP code format</span></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a><span class="ex">valid_zip_df</span> = df.dropna<span class="er">(</span><span class="va">subset</span><span class="op">=</span><span class="pp">[</span><span class="st">'zip_code'</span><span class="pp">]</span><span class="kw">)</span><span class="fu">.copy()</span></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a><span class="va">valid_zip_df</span><span class="op">[</span><span class="st">'zip_code'</span><span class="op">]</span> <span class="ex">=</span> valid_zip_df<span class="pp">[</span><span class="st">'zip_code'</span><span class="pp">]</span>.astype<span class="er">(</span><span class="ex">str</span><span class="kw">)</span><span class="ex">.str.zfill</span><span class="er">(</span><span class="ex">5</span><span class="kw">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Since <code>uszipcode</code> doesn’t valid_zip_dfrently support vectorized operations for multiple ZIP code queries, we’ll optimize the process by querying each unique ZIP code once, then merging the results with the original <code>DataFrame</code>. This approach minimizes redundant queries for ZIP codes that appear multiple</p>
<p>times.</p>
<div id="9f32043a" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> uszipcode <span class="im">import</span> SearchEngine</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the SearchEngine</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>search <span class="op">=</span> SearchEngine()</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch median home value and median household income for each unique ZIP code</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>zip_data <span class="op">=</span> []</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> zip_code <span class="kw">in</span> unique_zips:</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> search.by_zipcode(zip_code)</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> result:  <span class="co"># Check if the result is not None</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>        zip_data.append({</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">"zip_code"</span>: zip_code,</span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"median_home_value"</span>: result.median_home_value,</span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">"median_household_income"</span>: result.median_household_income</span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:  <span class="co"># Handle the case where the result is None</span></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>        zip_data.append({</span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">"zip_code"</span>: zip_code,</span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">"median_home_value"</span>: <span class="va">None</span>,</span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">"median_household_income"</span>: <span class="va">None</span></span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to DataFrame</span></span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a>zip_info_df <span class="op">=</span> pd.DataFrame(zip_data)</span>
<span id="cb89-25"><a href="#cb89-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-26"><a href="#cb89-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge this info back into the original DataFrame based on 'zip_code'</span></span>
<span id="cb89-27"><a href="#cb89-27" aria-hidden="true" tabindex="-1"></a>merged_df <span class="op">=</span> pd.merge(valid_zip_df, zip_info_df, how<span class="op">=</span><span class="st">"left"</span>, on<span class="op">=</span><span class="st">"zip_code"</span>)</span>
<span id="cb89-28"><a href="#cb89-28" aria-hidden="true" tabindex="-1"></a>merged_df.to_feather(<span class="st">'data/nyccrashes_merged.feather'</span>)</span>
<span id="cb89-29"><a href="#cb89-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-30"><a href="#cb89-30" aria-hidden="true" tabindex="-1"></a>merged_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="39">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">crash_datetime</th>
<th data-quarto-table-cell-role="th">borough</th>
<th data-quarto-table-cell-role="th">zip_code</th>
<th data-quarto-table-cell-role="th">latitude</th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">location</th>
<th data-quarto-table-cell-role="th">on_street_name</th>
<th data-quarto-table-cell-role="th">cross_street_name</th>
<th data-quarto-table-cell-role="th">off_street_name</th>
<th data-quarto-table-cell-role="th">number_of_persons_injured</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">contributing_factor_vehicle_4</th>
<th data-quarto-table-cell-role="th">contributing_factor_vehicle_5</th>
<th data-quarto-table-cell-role="th">collision_id</th>
<th data-quarto-table-cell-role="th">vehicle_type_code_1</th>
<th data-quarto-table-cell-role="th">vehicle_type_code_2</th>
<th data-quarto-table-cell-role="th">vehicle_type_code_3</th>
<th data-quarto-table-cell-role="th">vehicle_type_code_4</th>
<th data-quarto-table-cell-role="th">vehicle_type_code_5</th>
<th data-quarto-table-cell-role="th">median_home_value</th>
<th data-quarto-table-cell-role="th">median_household_income</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2024-06-30 07:05:00</td>
<td>BROOKLYN</td>
<td>11235</td>
<td>40.58106</td>
<td>-73.96744</td>
<td>(40.58106, -73.96744)</td>
<td>None</td>
<td>None</td>
<td>2797 OCEAN PARKWAY</td>
<td>0</td>
<td>...</td>
<td>None</td>
<td>None</td>
<td>4737060</td>
<td>Station Wagon/Sport Utility Vehicle</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>531000.0</td>
<td>41639.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2024-06-30 20:47:00</td>
<td>MANHATTAN</td>
<td>10021</td>
<td>40.76363</td>
<td>-73.95330</td>
<td>(40.76363, -73.9533)</td>
<td>FDR DRIVE</td>
<td>None</td>
<td>None</td>
<td>0</td>
<td>...</td>
<td>None</td>
<td>None</td>
<td>4737510</td>
<td>Sedan</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>1000001.0</td>
<td>107907.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2024-06-30 10:14:00</td>
<td>BROOKLYN</td>
<td>11222</td>
<td>40.73046</td>
<td>-73.95149</td>
<td>(40.73046, -73.95149)</td>
<td>GREENPOINT AVENUE</td>
<td>MC GUINNESS BOULEVARD</td>
<td>None</td>
<td>0</td>
<td>...</td>
<td>None</td>
<td>None</td>
<td>4736759</td>
<td>Bus</td>
<td>Box Truck</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>726500.0</td>
<td>63739.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2024-06-30 15:52:00</td>
<td>BRONX</td>
<td>10468</td>
<td>40.86685</td>
<td>-73.89597</td>
<td>(40.86685, -73.89597)</td>
<td>None</td>
<td>None</td>
<td>60 EAST KINGSBRIDGE ROAD</td>
<td>1</td>
<td>...</td>
<td>None</td>
<td>None</td>
<td>4736781</td>
<td>Station Wagon/Sport Utility Vehicle</td>
<td>Moped</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>171200.0</td>
<td>33776.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2024-06-30 16:30:00</td>
<td>BROOKLYN</td>
<td>11226</td>
<td>40.63969</td>
<td>-73.95321</td>
<td>(40.63969, -73.95321)</td>
<td>NEWKIRK AVENUE</td>
<td>EAST 25 STREET</td>
<td>None</td>
<td>1</td>
<td>...</td>
<td>None</td>
<td>None</td>
<td>4737299</td>
<td>Sedan</td>
<td>Moped</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>480500.0</td>
<td>40734.0</td>
</tr>
</tbody>
</table>

<p>5 rows × 30 columns</p>
</div>
</div>
</div>
</section>
<section id="extracting-and-analyzing-census-tract-data" class="level2" data-number="6.7">
<h2 data-number="6.7" class="anchored" data-anchor-id="extracting-and-analyzing-census-tract-data"><span class="header-section-number">6.7</span> Extracting and Analyzing Census Tract Data</h2>
<p>This section was authored by <strong>Mohammad Shahriyar Parvez</strong>, a Ph.D.&nbsp;scholar in the Department of Geography, Sustainability, and Urban Studies at the University of Connecticut. For any questions or difficulties in executing the content of this section, please feel free to reach out at <a href="mailto:shahriyar@uconn.edu">shahriyar@uconn.edu</a>.</p>
<p>This section explains how to access data from the US Decennial Census and the American Community Survey (ACS). Basic operations will be applied to calculate and map poverty rates in Storrs, CT. Data will be retrieved from the US Census Bureau’s 2022 <a href="https://www.census.gov/programs-surveys/acs">American Community Survey (ACS)</a> (refer to this <a href="https://www.census.gov/data/developers/data-sets/acs-5year.html">page</a> for the dataset).</p>
<div id="cadc8ee1" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import modules</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> census <span class="im">import</span> Census</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> us <span class="im">import</span> states</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="accessing-the-cencus-data" class="level3" data-number="6.7.1">
<h3 data-number="6.7.1" class="anchored" data-anchor-id="accessing-the-cencus-data"><span class="header-section-number">6.7.1</span> Accessing the cencus Data</h3>
<section id="import-census-data" class="level4" data-number="6.7.1.1">
<h4 data-number="6.7.1.1" class="anchored" data-anchor-id="import-census-data"><span class="header-section-number">6.7.1.1</span> Import census data</h4>
<p>Importing census data into Python requires a <a href="https://api.census.gov/data/key_signup.html">Census API</a> key. A key can be obtained from Census API Key. You have to provide your Institution name and email address. A unique 40 digit text string API will be sent to you. You have to keep track of this number and store it in a safe place.</p>
<div id="2d6e7514" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up the API key for accessing Census data</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"CencusAPI.txt"</span>) <span class="im">as</span> f:</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>    api_key <span class="op">=</span> f.read().strip()</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> Census(api_key)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once the Census API key is configured, access census data at the tract level for Connecticut using the 2022 ACS. Focus on these variables: total income-to-poverty ratio (<code>C17002_001E</code>), income less than 0.50 of the poverty level (<code>C17002_002E</code>), income between 0.50 and 0.99 of the poverty level (<code>C17002_003E</code>), and total population (<code>B01003_001E</code>). For details on why these variables are relevant to poverty analysis, refer to the <a href="https://www.census.gov/topics/income-poverty/poverty/guidance/poverty-measures.html">Census Bureau’s guidelines on poverty measurement</a> and the <a href="https://api.census.gov/data/2022/acs/acs5/variables.html">ACS variable</a> documentation.</p>
<p>Use the census package’s convenience methods to pull data for different geographic levels. The FIPS code for Connecticu is 09, but if necessary, use the <code>us</code> library to identify FIPS codes for other states.</p>
<div id="5ab960e3" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Obtain Census variables from the ACS at the tract level for Storrs, CT</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>ct_census <span class="op">=</span> c.acs5.state_county_tract(</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>    fields<span class="op">=</span>(<span class="st">'NAME'</span>, <span class="st">'C17002_001E'</span>, <span class="st">'C17002_002E'</span>, <span class="st">'C17002_003E'</span>, <span class="st">'B01003_001E'</span>),</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>    state_fips<span class="op">=</span>states.CT.fips,</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>    county_fips<span class="op">=</span><span class="st">"*"</span>,</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>    tract<span class="op">=</span><span class="st">"*"</span>,</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>    year<span class="op">=</span><span class="dv">2022</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With the data retrieved and assigned to a variable, load it into a DataFrame using the <code>pandas</code> library. This will allow for easy manipulation and analysis of the data.</p>
<div id="4d0d7740" class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dataframe from the census data</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>ct_df <span class="op">=</span> pd.DataFrame(ct_census)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the dataframe</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ct_df.head(<span class="dv">20</span>))</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Shape: '</span>, ct_df.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                 NAME  C17002_001E  \
0   Census Tract 4001.01; Capitol Planning Region;...       2916.0   
1   Census Tract 4001.02; Capitol Planning Region;...       4266.0   
2   Census Tract 4002; Capitol Planning Region; Co...       6213.0   
3   Census Tract 4003; Capitol Planning Region; Co...       6677.0   
4   Census Tract 4153; Capitol Planning Region; Co...       2615.0   
5   Census Tract 4154; Capitol Planning Region; Co...       6046.0   
6   Census Tract 4155; Capitol Planning Region; Co...       3245.0   
7   Census Tract 4156; Capitol Planning Region; Co...       4201.0   
8   Census Tract 4157; Capitol Planning Region; Co...       3284.0   
9   Census Tract 4158; Capitol Planning Region; Co...       2606.0   
10  Census Tract 4159; Capitol Planning Region; Co...       1427.0   
11  Census Tract 4160; Capitol Planning Region; Co...       4738.0   
12  Census Tract 4161; Capitol Planning Region; Co...       4995.0   
13  Census Tract 4162; Capitol Planning Region; Co...       2839.0   
14  Census Tract 4163; Capitol Planning Region; Co...       4533.0   
15  Census Tract 4164; Capitol Planning Region; Co...       3180.0   
16  Census Tract 4165; Capitol Planning Region; Co...       4364.0   
17  Census Tract 4166; Capitol Planning Region; Co...       3110.0   
18  Census Tract 4167; Capitol Planning Region; Co...       6364.0   
19  Census Tract 4168; Capitol Planning Region; Co...       3394.0   

    C17002_002E  C17002_003E  B01003_001E state county   tract  
0          41.0         22.0       2945.0    09    110  400101  
1          73.0        305.0       4266.0    09    110  400102  
2          55.0        136.0       6250.0    09    110  400200  
3         135.0        197.0       6688.0    09    110  400300  
4         465.0        360.0       2621.0    09    110  415300  
5         431.0        318.0       6046.0    09    110  415400  
6         408.0        353.0       3245.0    09    110  415500  
7         300.0        667.0       4303.0    09    110  415600  
8         134.0        169.0       3290.0    09    110  415700  
9         459.0        313.0       2775.0    09    110  415800  
10        131.0        405.0       1437.0    09    110  415900  
11        382.0        646.0       4738.0    09    110  416000  
12        509.0        992.0       5017.0    09    110  416100  
13        133.0        633.0       2911.0    09    110  416200  
14        373.0        796.0       4533.0    09    110  416300  
15         50.0        110.0       3185.0    09    110  416400  
16        350.0        180.0       4404.0    09    110  416500  
17        403.0        196.0       3171.0    09    110  416600  
18        424.0       1109.0       6481.0    09    110  416700  
19        401.0         13.0       3394.0    09    110  416800  
Shape:  (884, 8)</code></pre>
</div>
</div>
<p>Displaying the DataFrame reveals 884 rows, indicating 884 census tracts, along with 8 columns. This structure provides a comprehensive view of the data across all selected tracts.</p>
</section>
<section id="import-shapefile" class="level4" data-number="6.7.1.2">
<h4 data-number="6.7.1.2" class="anchored" data-anchor-id="import-shapefile"><span class="header-section-number">6.7.1.2</span> Import Shapefile</h4>
<p>Read the Connecticut census tracts shapefile into Python and reproject it to the UTM Zone 18N projection. The shapefile is available for download from the Census Bureau’s website, specifically on the <a href="https://www.census.gov/geographies/mapping-files/time-series/geo/carto-boundary-file.html">Cartographic Boundary Files</a> page or the <a href="https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.html">TIGER/Line Shapefiles</a> page.</p>
<div id="35da198f" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Access shapefile of Connecticut census tracts</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>ct_tract <span class="op">=</span> gpd.read_file(<span class="st">"https://www2.census.gov/geo/tiger/TIGER2024/TRACT/"</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"tl_2024_09_tract.zip"</span>)</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Reproject shapefile to UTM Zone 18N</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>ct_tract <span class="op">=</span> ct_tract.to_crs(epsg<span class="op">=</span><span class="dv">32618</span>)</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print GeoDataFrame of shapefile</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ct_tract.head(<span class="dv">2</span>))</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Shape: '</span>, ct_tract.shape)</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">The shapefile projection is: </span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(ct_tract.crs))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  STATEFP COUNTYFP TRACTCE        GEOID               GEOIDFQ  NAME  \
0      09      110  535200  09110535200  1400000US09110535200  5352   
1      09      110  881200  09110881200  1400000US09110881200  8812   

            NAMELSAD  MTFCC FUNCSTAT     ALAND   AWATER     INTPTLAT  \
0  Census Tract 5352  G5020        S  43206583  1355239  +41.9294855   
1  Census Tract 8812  G5020        S   2273066    28584  +41.8089384   

       INTPTLON                                           geometry  
0  -072.4062911  POLYGON ((710429.8 4638466.647, 710437.611 463...  
1  -072.2516171  POLYGON ((727399.183 4633086.018, 727416.326 4...  
Shape:  (884, 14)

The shapefile projection is: EPSG:32618</code></pre>
</div>
</div>
<p>Printing the shapefile confirms it also contains 884 rows, representing 884 census tracts. This matches the number of census records, which is a good start!</p>
<p>However, there’s a potential issue: while we have the census data and the shapefile of corresponding census tracts, they are currently stored in two separate variables (<code>ct_df</code> and <code>ct_tract</code>). This separation complicates mapping, as the datasets are not yet linked.</p>
</section>
</section>
<section id="performing-dataframe-operations" class="level3" data-number="6.7.2">
<h3 data-number="6.7.2" class="anchored" data-anchor-id="performing-dataframe-operations"><span class="header-section-number">6.7.2</span> Performing Dataframe Operations</h3>
<section id="create-new-column-from-old-columns" class="level4" data-number="6.7.2.1">
<h4 data-number="6.7.2.1" class="anchored" data-anchor-id="create-new-column-from-old-columns"><span class="header-section-number">6.7.2.1</span> Create new column from old columns</h4>
<p>To address this issue, join the two DataFrames using a shared field, or “key,” that is common to both datasets.</p>
<p>After reviewing the two datasets, the <code>GEOID</code> column in <code>ct_tract</code> and the combination of the <code>state</code>, <code>county</code>, and <code>tract</code> columns in <code>ct_df</code> can serve as a unique key for joining. Currently, these columns are not in a format that can be directly matched, so the <code>state</code>, <code>county</code>, and <code>tract</code> columns from <code>ct_df</code> will need to be merged into a single column to align with the <code>GEOID</code> column in <code>ct_tract</code>.</p>
<p>To create this new column—or access any existing column in a DataFrame—use indexing with <code>[]</code> and the column name as a string. (Alternatively, columns can be accessed by index position; see the <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html">pandas documentation on indexing and selecting data</a> for more details.)</p>
<div id="9224bb25" class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine state, county, and tract columns together</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>ct_df[<span class="st">"GEOID"</span>] <span class="op">=</span> ct_df[<span class="st">"state"</span>] <span class="op">+</span> ct_df[<span class="st">"county"</span>] <span class="op">+</span> ct_df[<span class="st">"tract"</span>]</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print head of dataframe</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>ct_df.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">NAME</th>
<th data-quarto-table-cell-role="th">C17002_001E</th>
<th data-quarto-table-cell-role="th">C17002_002E</th>
<th data-quarto-table-cell-role="th">C17002_003E</th>
<th data-quarto-table-cell-role="th">B01003_001E</th>
<th data-quarto-table-cell-role="th">state</th>
<th data-quarto-table-cell-role="th">county</th>
<th data-quarto-table-cell-role="th">tract</th>
<th data-quarto-table-cell-role="th">GEOID</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Census Tract 4001.01; Capitol Planning Region;...</td>
<td>2916.0</td>
<td>41.0</td>
<td>22.0</td>
<td>2945.0</td>
<td>09</td>
<td>110</td>
<td>400101</td>
<td>09110400101</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Census Tract 4001.02; Capitol Planning Region;...</td>
<td>4266.0</td>
<td>73.0</td>
<td>305.0</td>
<td>4266.0</td>
<td>09</td>
<td>110</td>
<td>400102</td>
<td>09110400102</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Census Tract 4002; Capitol Planning Region; Co...</td>
<td>6213.0</td>
<td>55.0</td>
<td>136.0</td>
<td>6250.0</td>
<td>09</td>
<td>110</td>
<td>400200</td>
<td>09110400200</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Census Tract 4003; Capitol Planning Region; Co...</td>
<td>6677.0</td>
<td>135.0</td>
<td>197.0</td>
<td>6688.0</td>
<td>09</td>
<td>110</td>
<td>400300</td>
<td>09110400300</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Census Tract 4153; Capitol Planning Region; Co...</td>
<td>2615.0</td>
<td>465.0</td>
<td>360.0</td>
<td>2621.0</td>
<td>09</td>
<td>110</td>
<td>415300</td>
<td>09110415300</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Census Tract 4154; Capitol Planning Region; Co...</td>
<td>6046.0</td>
<td>431.0</td>
<td>318.0</td>
<td>6046.0</td>
<td>09</td>
<td>110</td>
<td>415400</td>
<td>09110415400</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Census Tract 4155; Capitol Planning Region; Co...</td>
<td>3245.0</td>
<td>408.0</td>
<td>353.0</td>
<td>3245.0</td>
<td>09</td>
<td>110</td>
<td>415500</td>
<td>09110415500</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Census Tract 4156; Capitol Planning Region; Co...</td>
<td>4201.0</td>
<td>300.0</td>
<td>667.0</td>
<td>4303.0</td>
<td>09</td>
<td>110</td>
<td>415600</td>
<td>09110415600</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>Census Tract 4157; Capitol Planning Region; Co...</td>
<td>3284.0</td>
<td>134.0</td>
<td>169.0</td>
<td>3290.0</td>
<td>09</td>
<td>110</td>
<td>415700</td>
<td>09110415700</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>Census Tract 4158; Capitol Planning Region; Co...</td>
<td>2606.0</td>
<td>459.0</td>
<td>313.0</td>
<td>2775.0</td>
<td>09</td>
<td>110</td>
<td>415800</td>
<td>09110415800</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>By printing the first few rows of the DataFrame, the newly created <code>GEOID</code> column is visible, showing the combined values from the <code>state</code>, <code>county</code>, and <code>tract</code> columns. This new column now matches the format of the <code>GEOID</code> column in <code>ct_tract</code>, setting up the data for a successful join.</p>
</section>
<section id="remove-dataframe-columns-that-are-no-longer-needed" class="level4" data-number="6.7.2.2">
<h4 data-number="6.7.2.2" class="anchored" data-anchor-id="remove-dataframe-columns-that-are-no-longer-needed"><span class="header-section-number">6.7.2.2</span> Remove dataframe columns that are no longer needed</h4>
<p>To minimize clutter, delete the <code>state</code>, <code>county</code>, and <code>tract</code> columns from <code>ct_df</code>, as they’re no longer needed after creating the <code>GEOID</code> column. When modifying a DataFrame, reassign the modified DataFrame back to the original variable (or a new variable if preferred) to save the changes. Alternatively, use <code>inplace=True</code> within the <code>drop</code> function to apply changes directly without reassignment. For additional details, refer to the <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.drop.html">pandas documentation on <code>drop</code></a>.</p>
<div id="8661221a" class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove columns</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>ct_df <span class="op">=</span> ct_df.drop(columns <span class="op">=</span> [<span class="st">"state"</span>, <span class="st">"county"</span>, <span class="st">"tract"</span>])</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Show updated dataframe</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>ct_df.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="46">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">NAME</th>
<th data-quarto-table-cell-role="th">C17002_001E</th>
<th data-quarto-table-cell-role="th">C17002_002E</th>
<th data-quarto-table-cell-role="th">C17002_003E</th>
<th data-quarto-table-cell-role="th">B01003_001E</th>
<th data-quarto-table-cell-role="th">GEOID</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Census Tract 4001.01; Capitol Planning Region;...</td>
<td>2916.0</td>
<td>41.0</td>
<td>22.0</td>
<td>2945.0</td>
<td>09110400101</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Census Tract 4001.02; Capitol Planning Region;...</td>
<td>4266.0</td>
<td>73.0</td>
<td>305.0</td>
<td>4266.0</td>
<td>09110400102</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="check-column-data-types" class="level4" data-number="6.7.2.3">
<h4 data-number="6.7.2.3" class="anchored" data-anchor-id="check-column-data-types"><span class="header-section-number">6.7.2.3</span> Check column data types</h4>
<p>Ensure that the key column (<code>GEOID</code>) in both DataFrames is of the same data type to allow for a successful join. Start by checking the data type of the <code>GEOID</code> column in each DataFrame. If the data types differ, adjust one or both columns as needed to make them consistent.</p>
<div id="2c572509" class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check column data types for census data</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ct_df.dtypes)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check column data types for census shapefile</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ct_tract.dtypes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NAME            object
C17002_001E    float64
C17002_002E    float64
C17002_003E    float64
B01003_001E    float64
GEOID           object
dtype: object
STATEFP       object
COUNTYFP      object
TRACTCE       object
GEOID         object
GEOIDFQ       object
NAME          object
NAMELSAD      object
MTFCC         object
FUNCSTAT      object
ALAND          int64
AWATER         int64
INTPTLAT      object
INTPTLON      object
geometry    geometry
dtype: object</code></pre>
</div>
</div>
</section>
<section id="merge-dataframes" class="level4" data-number="6.7.2.4">
<h4 data-number="6.7.2.4" class="anchored" data-anchor-id="merge-dataframes"><span class="header-section-number">6.7.2.4</span> Merge dataframes</h4>
<p>Now it’s time to merge the two DataFrames using the <code>GEOID</code> columns as the primary key. Use the <code>merge</code> method in GeoPandas, applying it to the <code>va_tract</code> shapefile dataset to combine the data based on the <code>GEOID</code> column.</p>
<div id="51f9ca0e" class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the attributes of the dataframes together</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>ct_merge <span class="op">=</span> ct_tract.merge(ct_df, on <span class="op">=</span> <span class="st">"GEOID"</span>)</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Show result</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ct_merge.head(<span class="dv">2</span>))</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Shape: '</span>, ct_merge.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  STATEFP COUNTYFP TRACTCE        GEOID               GEOIDFQ NAME_x  \
0      09      110  535200  09110535200  1400000US09110535200   5352   
1      09      110  881200  09110881200  1400000US09110881200   8812   

            NAMELSAD  MTFCC FUNCSTAT     ALAND   AWATER     INTPTLAT  \
0  Census Tract 5352  G5020        S  43206583  1355239  +41.9294855   
1  Census Tract 8812  G5020        S   2273066    28584  +41.8089384   

       INTPTLON                                           geometry  \
0  -072.4062911  POLYGON ((710429.8 4638466.647, 710437.611 463...   
1  -072.2516171  POLYGON ((727399.183 4633086.018, 727416.326 4...   

                                              NAME_y  C17002_001E  \
0  Census Tract 5352; Capitol Planning Region; Co...       6650.0   
1  Census Tract 8812; Capitol Planning Region; Co...        502.0   

   C17002_002E  C17002_003E  B01003_001E  
0        102.0        213.0       6664.0  
1        318.0         15.0      10590.0  
Shape:  (884, 19)</code></pre>
</div>
</div>
<p>The merged DataFrame still has 884 rows, indicating that all (or nearly all) rows were matched correctly. The census data has now been appended to the shapefile data within the DataFrame.</p>
<p><strong><em>Additional Notes on Joining DataFrames</em></strong></p>
<ul>
<li>The columns used as keys do not need to have the same name, as long as they contain matching data.</li>
<li>This join was a <strong>one-to-one relationship</strong>, where each attribute in one DataFrame matched exactly one attribute in the other. Joins with <strong>many-to-one</strong>, <strong>one-to-many</strong>, or <strong>many-to-many</strong> relationships are also possible, though they may require additional considerations. For more details, refer to the <a href="https://desktop.arcgis.com/en/arcmap/latest/manage-data/tables/about-joining-and-relating-tables.htm">Esri ArcGIS documentation on joins and relates</a>.</li>
</ul>
</section>
<section id="subset-dataframe" class="level4" data-number="6.7.2.5">
<h4 data-number="6.7.2.5" class="anchored" data-anchor-id="subset-dataframe"><span class="header-section-number">6.7.2.5</span> Subset dataframe</h4>
<p>With the DataFrames merged, further clean up the data by removing unnecessary columns. Instead of using the <code>drop</code> method, select only the columns needed and create a new DataFrame containing just those selected columns. This approach streamlines the DataFrame and keeps only the relevant data for analysis.</p>
<div id="98963131" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create new dataframe from select columns</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>ct_poverty_tract <span class="op">=</span> ct_merge[[<span class="st">"STATEFP"</span>, <span class="st">"COUNTYFP"</span>, <span class="st">"TRACTCE"</span>, </span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"GEOID"</span>, <span class="st">"geometry"</span>, <span class="st">"C17002_001E"</span>, </span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"C17002_002E"</span>, <span class="st">"C17002_003E"</span>, </span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"B01003_001E"</span>]]</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Show dataframe</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ct_poverty_tract.head(<span class="dv">2</span>))</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Shape: '</span>, ct_poverty_tract.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  STATEFP COUNTYFP TRACTCE        GEOID  \
0      09      110  535200  09110535200   
1      09      110  881200  09110881200   

                                            geometry  C17002_001E  \
0  POLYGON ((710429.8 4638466.647, 710437.611 463...       6650.0   
1  POLYGON ((727399.183 4633086.018, 727416.326 4...        502.0   

   C17002_002E  C17002_003E  B01003_001E  
0        102.0        213.0       6664.0  
1        318.0         15.0      10590.0  
Shape:  (884, 9)</code></pre>
</div>
</div>
<p>The number of columns has reduced from 19 to 9, streamlining the data for analysis.</p>
</section>
<section id="calculate-poverty-rates-using-column-math" class="level4" data-number="6.7.2.6">
<h4 data-number="6.7.2.6" class="anchored" data-anchor-id="calculate-poverty-rates-using-column-math"><span class="header-section-number">6.7.2.6</span> Calculate Poverty Rates Using Column Math</h4>
<p>To estimate the poverty rate, divide the sum of <code>C17002_002E</code> (ratio of income to poverty in the past 12 months, &lt; 0.50) and <code>C17002_003E</code> (ratio of income to poverty in the past 12 months, 0.50 - 0.99) by <code>B01003_001E</code> (total population). This calculation provides the proportion of the population below the poverty line.</p>
<p><strong>Note:</strong> <code>C17002_001E</code> (ratio of income to poverty in the past 12 months, total) should theoretically represent the entire population, but it does not exactly match <code>B01003_001E</code> (total population). This discrepancy is minor, so it will be disregarded for the purpose of this calculation.</p>
<div id="191dfc0a" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get poverty rate and store ctlues in new column</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>ct_poverty_tract[<span class="st">"Poverty_Rate"</span>] <span class="op">=</span> (</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>    (ct_poverty_tract[<span class="st">"C17002_002E"</span>] <span class="op">+</span> ct_poverty_tract[<span class="st">"C17002_003E"</span>])</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">/</span> ct_poverty_tract[<span class="st">"B01003_001E"</span>] <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Show dataframe</span></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>ct_poverty_tract.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/Users/junyan/work/teaching/ids-f24/ids-f24/.ids-f24-venv/lib/python3.12/site-packages/geopandas/geodataframe.py:1819: SettingWithCopyWarning:


A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="50">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">STATEFP</th>
<th data-quarto-table-cell-role="th">COUNTYFP</th>
<th data-quarto-table-cell-role="th">TRACTCE</th>
<th data-quarto-table-cell-role="th">GEOID</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">C17002_001E</th>
<th data-quarto-table-cell-role="th">C17002_002E</th>
<th data-quarto-table-cell-role="th">C17002_003E</th>
<th data-quarto-table-cell-role="th">B01003_001E</th>
<th data-quarto-table-cell-role="th">Poverty_Rate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>09</td>
<td>110</td>
<td>535200</td>
<td>09110535200</td>
<td>POLYGON ((710429.8 4638466.647, 710437.611 463...</td>
<td>6650.0</td>
<td>102.0</td>
<td>213.0</td>
<td>6664.0</td>
<td>4.726891</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>09</td>
<td>110</td>
<td>881200</td>
<td>09110881200</td>
<td>POLYGON ((727399.183 4633086.018, 727416.326 4...</td>
<td>502.0</td>
<td>318.0</td>
<td>15.0</td>
<td>10590.0</td>
<td>3.144476</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="plotting-the-results" class="level4" data-number="6.7.2.7">
<h4 data-number="6.7.2.7" class="anchored" data-anchor-id="plotting-the-results"><span class="header-section-number">6.7.2.7</span> Plotting the Results</h4>
<p>With the spatial component linked to the census data, the results can now be visualized on a map. Plot the data to display poverty rates across counties, taking advantage of the merged spatial information for a clear geographic representation of poverty distribution.</p>
<div id="03b82d68" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create subplots</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize <span class="op">=</span> (<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot data</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>ct_poverty_tract.plot(column <span class="op">=</span> <span class="st">"Poverty_Rate"</span>,</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>                       ax <span class="op">=</span> ax,</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>                       cmap <span class="op">=</span> <span class="st">"plasma"</span>,</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>                       legend <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Stylize plots</span></span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">'bmh'</span>)</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Set title</span></span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Poverty Rates (%) in Connecticut'</span>, fontdict <span class="op">=</span> {</span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'fontsize'</span>: <span class="st">'25'</span>, <span class="st">'fontweight'</span> : <span class="st">'3'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>Text(0.5, 1.0, 'Poverty Rates (%) in Connecticut')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="manipulation_files/figure-html/cell-54-output-2.png" width="873" height="624" class="figure-img"></p>
</figure>
</div>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./communication.html" class="pagination-link" aria-label="Communication in Data Science">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Communication in Data Science</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./visualization.html" class="pagination-link" aria-label="Visualization">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Visualization</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>